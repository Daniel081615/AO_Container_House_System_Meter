; generated by Component: ARM Compiler 5.05 update 1 (build 106) Tool: ArmCC [4d0efa]
; commandline ArmCC [--list --split_sections --debug -c --asm --interleave -o.\obj\ao_meterprocess.o --asm_dir=.\lst\ --list_dir=.\lst\ --depend=.\obj\ao_meterprocess.d --cpu=Cortex-M0 --apcs=interwork -O0 --diag_suppress=9931 -I..\..\..\Library\CMSIS\Include -I..\..\..\Library\Device\Nuvoton\NUC126\Include -I..\..\..\Library\StdDriver\inc -I..\..\..\NUC126_Series_BSP_CMSIS_V3.00.005\Library\StdDriver\inc -I..\..\..\NUC126_Series_BSP_CMSIS_V3.00.005\Library\Device\Nuvoton\NUC126\Include -I..\..\..\NUC126_Series_BSP_CMSIS_V3.00.005\Library\CMSIS\Include -IC:\Keil_v5\ARM\RV31\INC -IC:\Keil_v5\ARM\CMSIS\Include -D__MICROLIB -D__UVISION_VERSION=514 --omf_browse=.\obj\ao_meterprocess.crf ..\AO_MeterProcess.c]
                          THUMB

                          AREA ||i.CalChecksumM||, CODE, READONLY, ALIGN=2

                  CalChecksumM PROC
;;;700    }
;;;701    void CalChecksumM(void)
000000  b570              PUSH     {r4-r6,lr}
;;;702    {
;;;703    	uint8_t i;
;;;704    	uint8_t Checksum;
;;;705        
;;;706    	Checksum = 0 ;
000002  2500              MOVS     r5,#0
;;;707    	for (i=1;i<(METER_TOKEN_LENGTH-2);i++)
000004  2401              MOVS     r4,#1
000006  e005              B        |L1.20|
                  |L1.8|
;;;708    	{
;;;709    		Checksum += MeterTxBuffer[i];
000008  4808              LDR      r0,|L1.44|
00000a  5d00              LDRB     r0,[r0,r4]
00000c  1940              ADDS     r0,r0,r5
00000e  b2c5              UXTB     r5,r0
000010  1c60              ADDS     r0,r4,#1              ;707
000012  b2c4              UXTB     r4,r0                 ;707
                  |L1.20|
000014  2c17              CMP      r4,#0x17              ;707
000016  dbf7              BLT      |L1.8|
;;;710    	}	
;;;711    	MeterTxBuffer[METER_TOKEN_LENGTH-2] = Checksum ;
000018  4804              LDR      r0,|L1.44|
00001a  75c5              STRB     r5,[r0,#0x17]
;;;712    	MeterTxBuffer[METER_TOKEN_LENGTH-1] = '\n' ;
00001c  200a              MOVS     r0,#0xa
00001e  4903              LDR      r1,|L1.44|
000020  7608              STRB     r0,[r1,#0x18]
;;;713    	//DIR485_METER_Out();
;;;714    	_SendStringToMETER(MeterTxBuffer,METER_TOKEN_LENGTH);
000022  2119              MOVS     r1,#0x19
000024  4801              LDR      r0,|L1.44|
000026  f7fffffe          BL       _SendStringToMETER
;;;715    }
00002a  bd70              POP      {r4-r6,pc}
;;;716    #define METER_ERROR_TIMES 	5
                          ENDP

                  |L1.44|
                          DCD      MeterTxBuffer

                          AREA ||i.MeterDataProcess||, CODE, READONLY, ALIGN=2

                  MeterDataProcess PROC
;;;423    
;;;424    void MeterDataProcess(void)
000000  b530              PUSH     {r4,r5,lr}
;;;425    {
;;;426    	uint32_t tmpMeterPower,GapMeterPower;
;;;427        uint8_t u8PowerMeterID;
;;;428        
;;;429            u8PowerMeterID = TokenMeter[0];
000002  4bfb              LDR      r3,|L2.1008|
000004  7818              LDRB     r0,[r3,#0]  ; TokenMeter
;;;430            if ( u8PowerMeterID > 0 ) 
000006  2800              CMP      r0,#0
000008  dd02              BLE      |L2.16|
;;;431                u8PowerMeterID = u8PowerMeterID - 1;
00000a  1e43              SUBS     r3,r0,#1
00000c  b2d8              UXTB     r0,r3
00000e  e000              B        |L2.18|
                  |L2.16|
;;;432            else 
;;;433                return;        
;;;434            
;;;435    	LED_G_TOGGLE();
;;;436    	if ( TokenMeter[1] == 0x03 )
;;;437    	{		
;;;438    		// だRq慝准 
;;;439    		if ( MeterMBCmd == MDBS_METER_GET_WATT )
;;;440    		{	
;;;441    			switch ( MeterType )
;;;442    			{
;;;443    				case DAE_530n540 :
;;;444    					tmpMeterPower = (TokenMeter[5] << 24) + (TokenMeter[6] << 16) + (TokenMeter[3] << 8) + TokenMeter[4] ;
;;;445    					break;
;;;446    				case CIC_BAW2A :
;;;447    					tmpMeterPower = (TokenMeter[3] << 24) + (TokenMeter[4] << 16) + (TokenMeter[5] << 8) + TokenMeter[6] ;
;;;448    					break;
;;;449    				case TUTANG_E21nE31 :
;;;450    					tmpMeterPower = (TokenMeter[5] << 24) + (TokenMeter[6] << 16) + (TokenMeter[3] << 8) + TokenMeter[4] ;
;;;451    					break;
;;;452    				default :
;;;453    					tmpMeterPower = (TokenMeter[5] << 24) + (TokenMeter[6] << 16) + (TokenMeter[3] << 8) + TokenMeter[4] ;
;;;454    					break;
;;;455    			}
;;;456                        // 2025.07.02 START
;;;457                        // MeterData[u8PowerMeterID].MeterTotalWatt = tmpMeterPower;
;;;458                        MeterPowerValue_Now = MeterData[u8PowerMeterID].MeterTotalWatt;
;;;459                        // 2025.07.02 END
;;;460    			if ( PowerOnReadMeter )
;;;461    			{
;;;462    				PowerOnReadMeter = 0 ;
;;;463    				MeterPowerValue_Now = tmpMeterPower ;
;;;464    				LastMeterPower[u8PowerMeterID] = MeterPowerValue_Now ;
;;;465    				MeterData[u8PowerMeterID].MeterTotalWatt = MeterPowerValue_Now ;
;;;466    				//MeterData[u8PowerMeterID].RelayStatus = 1 ;
;;;467                               RoomData.Status &= (~FLAG_POWER_METER_READY) ;
;;;468                               GapErrorTimes[u8PowerMeterID] = 0 ;
;;;469    			}
;;;470    			
;;;471    			if ( tmpMeterPower >= MeterPowerValue_Now )
;;;472    			{
;;;473    				// q况去姬蠓s
;;;474    				if (tmpMeterPower == MeterPowerValue_Now) return;
;;;475    
;;;476    				GapMeterPower = tmpMeterPower - MeterPowerValue_Now;
;;;477    				// Check Over Value < 200 
;;;478    				if ( GapMeterPower < 200 )
;;;479    				{
;;;480    					MeterPowerValue_Now = tmpMeterPower ;
;;;481                                      LastMeterPower[u8PowerMeterID] = MeterPowerValue_Now;
;;;482                                      MeterData[u8PowerMeterID].MeterTotalWatt = MeterPowerValue_Now ;
;;;483    				       RoomData.Status &= (~FLAG_POWER_METER_READY) ;												
;;;484    					GapErrorTimes[u8PowerMeterID] = 0 ;
;;;485    				} else {
;;;486    					GapErrorTimes[u8PowerMeterID] ++;
;;;487    					if ( GapErrorTimes[u8PowerMeterID] > 3 ) 
;;;488    					{
;;;489    						MeterPowerValue_Now = tmpMeterPower ;
;;;490    						LastMeterPower[u8PowerMeterID] = MeterPowerValue_Now;						
;;;491    						GapErrorTimes[u8PowerMeterID] = 0 ;
;;;492    						MeterData[u8PowerMeterID].MeterTotalWatt = MeterPowerValue_Now ;
;;;493    						//WritePowerToEE();
;;;494    						RoomData.Status &= (~FLAG_POWER_METER_READY) ;
;;;495    					}
;;;496    				}
;;;497    			} else {
;;;498    				// 钵`p : 弄^准皮p螭Йe准啤Ai唰蟠q况pAゲ斗s尿3Ω~蠓sq况					
;;;499    				// 钵`p : ゲ斗s尿3Ω~i妲蠓s ( q`哀蟠q )				
;;;500    				GapErrorTimes[u8PowerMeterID] ++;
;;;501    				if ( GapErrorTimes[u8PowerMeterID] > 3 )
;;;502    				{
;;;503    					MeterPowerValue_Now = tmpMeterPower ;
;;;504    					LastMeterPower[u8PowerMeterID] = MeterPowerValue_Now;	
;;;505    					MeterData[u8PowerMeterID].MeterTotalWatt = MeterPowerValue_Now ;
;;;506    					// Save to EE xsEEPROM
;;;507    					//WritePowerToEE();
;;;508    					GapErrorTimes[u8PowerMeterID] = 0 ;
;;;509    					RoomData.Status &= (~FLAG_POWER_METER_READY) ;
;;;510    				}		
;;;511    			}			
;;;512    		}
;;;513    
;;;514    		// だRq况~q竟A
;;;515    		if ( MeterMBCmd == MDBS_METER_GET_RELAY )
;;;516    		{
;;;517    			switch ( MeterType )
;;;518    			{
;;;519    				case DAE_530n540 :
;;;520    					// x旃q DAE DEM530/540
;;;521    					if (TokenMeter[4] == 0x00)
;;;522    					{
;;;523    						MeterRelayStatus = 0x01 ;
;;;524                                                        MeterData[u8PowerMeterID].RelayStatus = RELAY_OFF;
;;;525    						//LED_BS_Off();
;;;526    					} else {					
;;;527    						MeterRelayStatus = 0x00 ;
;;;528                                                        MeterData[u8PowerMeterID].RelayStatus = RELAY_ON ;
;;;529    						//LED_BS_On();
;;;530    					} 
;;;531    					break;
;;;532    				case CIC_BAW2A :
;;;533    					// ォO BAW-2A
;;;534    					if (TokenMeter[4] == 0x01)
;;;535    					{
;;;536    					    // RELAY ON
;;;537    					    MeterData[u8PowerMeterID].RelayStatus = RELAY_ON;
;;;538    						MeterRelayStatus = 0x01 ;
;;;539    						//LED_BS_On();
;;;540    					} 
;;;541    					if (TokenMeter[4] == 0x02)
;;;542    					{
;;;543    					    // RELAY OFF
;;;544    					    MeterData[u8PowerMeterID].RelayStatus = RELAY_OFF;
;;;545    						MeterRelayStatus = 0x00 ;
;;;546    						//LED_BS_Off();
;;;547    					} 
;;;548    					break;
;;;549    				case TUTANG_E21nE31 :
;;;550    					// jP E21/E31
;;;551    					if (TokenMeter[4] == 0x00)
;;;552    					{
;;;553    					    // OFF
;;;554    					    MeterData[u8PowerMeterID].RelayStatus = RELAY_OFF;
;;;555    						MeterRelayStatus = 0x00 ;
;;;556    						//LED_BS_Off();
;;;557    					} else {			
;;;558    					    // ON
;;;559    					    MeterData[u8PowerMeterID].RelayStatus = RELAY_ON;
;;;560    						MeterRelayStatus = 0x01 ;
;;;561    						//LED_BS_On();
;;;562    					} 
;;;563    					break;
;;;564    			}						
;;;565    		}
;;;566    			
;;;567    		// だRq况lB
;;;568    		if ( MeterMBCmd == MDBS_METER_GET_BAL)
;;;569    		{
;;;570    			switch ( MeterType )
;;;571    			{
;;;572    				case DAE_530n540 :
;;;573    					break;
;;;574    				case CIC_BAW2A :
;;;575    					// ォO BAW-2A					
;;;576    					MeterData[u8PowerMeterID].MeterBalance = ( (TokenMeter[3]) << 24) + ( (TokenMeter[4]) << 16) + ( (TokenMeter[5]) << 8) + (TokenMeter[6]) ;
;;;577                                                
;;;578    					if ( (MeterData[u8PowerMeterID].MeterBalance < 99900) && (RoomMode[u8PowerMeterID] == RM_FREE_MODE_READY))
;;;579    					{
;;;580    					    if ( ModBusCommandList[u8PowerMeterID] == MBCMD_READY )
;;;581                                                    {               
;;;582    						ModBusCommandList[u8PowerMeterID] = MBCMD_ADD_VALUE ;
;;;583                                                    }
;;;584    					} 				
;;;585    					break;
;;;586    				case TUTANG_E21nE31 :
;;;587    					// jP E21/E31					
;;;588    					break;
;;;589    			}						
;;;590    		}
;;;591    		// q溃
;;;592    		if ( MeterMBCmd == MDBS_METER_GET_V )
;;;593    		{
;;;594    			switch ( MeterType )
;;;595    			{
;;;596    				case DAE_530n540 :					
;;;597    					break;
;;;598    				case CIC_BAW2A :
;;;599    					MeterData[u8PowerMeterID].MeterValtage = (TokenMeter[3] << 24) + (TokenMeter[4] << 16) + (TokenMeter[5] << 8) + TokenMeter[6] ;
;;;600    					break;
;;;601    				case TUTANG_E21nE31 :
;;;602    					
;;;603    					break;
;;;604    			}						
;;;605    		}
;;;606    		// qy
;;;607    		if ( MeterMBCmd == MDBS_METER_GET_I )
;;;608    		{
;;;609    			switch ( MeterType )
;;;610    			{
;;;611    				case DAE_530n540 :					
;;;612    					break;
;;;613    				case CIC_BAW2A :
;;;614    					MeterData[u8PowerMeterID].MeterCurrent = (TokenMeter[3] << 24) + (TokenMeter[4] << 16) + (TokenMeter[5] << 8) + TokenMeter[6] ;
;;;615    					break;
;;;616    				case TUTANG_E21nE31 :
;;;617    					
;;;618    					break;
;;;619    			}						
;;;620    		}
;;;621    		// Wv
;;;622    		if ( MeterMBCmd == MDBS_METER_GET_F )
;;;623    		{
;;;624    			switch ( MeterType )
;;;625    			{
;;;626    				case DAE_530n540 :					
;;;627    					break;
;;;628    				case CIC_BAW2A :
;;;629    					MeterData[u8PowerMeterID].MeterFreq =  (TokenMeter[3] << 8) + TokenMeter[4] ;
;;;630    					break;
;;;631    				case TUTANG_E21nE31 :
;;;632    					
;;;633    					break;
;;;634    			}						
;;;635    		}
;;;636    		// Τ\\v		
;;;637    		if ( MeterMBCmd == MDBS_METER_GET_P )
;;;638    		{
;;;639    			switch ( MeterType )
;;;640    			{
;;;641    				case DAE_530n540 :					
;;;642    					break;
;;;643    				case CIC_BAW2A :
;;;644    					MeterData[u8PowerMeterID].MeterVA = (TokenMeter[3] << 24) + (TokenMeter[4] << 16) + (TokenMeter[5] << 8) + TokenMeter[6] ;
;;;645    					break;
;;;646    				case TUTANG_E21nE31 :
;;;647    					
;;;648    					break;
;;;649    			}						
;;;650    		}
;;;651    		// 跌b\v		
;;;652    		if ( MeterMBCmd == MDBS_METER_GET_S )
;;;653    		{
;;;654    			switch ( MeterType )
;;;655    			{
;;;656    				case DAE_530n540 :					
;;;657    					break;
;;;658    				case CIC_BAW2A :
;;;659    					MeterData[u8PowerMeterID].MeterVA = (TokenMeter[3] << 24) + (TokenMeter[4] << 16) + (TokenMeter[5] << 8) + TokenMeter[6] ;
;;;660    					break;
;;;661    				case TUTANG_E21nE31 :
;;;662    					
;;;663    					break;
;;;664    			}						
;;;665    		}
;;;666    		// \v]l
;;;667    		if ( MeterMBCmd == MDBS_METER_GET_PF )
;;;668    		{
;;;669    			switch ( MeterType )
;;;670    			{
;;;671    				case DAE_530n540 :					
;;;672    					break;
;;;673    				case CIC_BAW2A :
;;;674    					MeterData[u8PowerMeterID].MeterPowerFactor =  (TokenMeter[3] << 8) + TokenMeter[4] ;
;;;675    					break;
;;;676    				case TUTANG_E21nE31 :
;;;677    					
;;;678    					break;
;;;679    			}						
;;;680    		}
;;;681                      //
;;;682    		if ( MeterMBCmd == MDBS_METER_GET_MODE)
;;;683    		{
;;;684    		    MeterData[u8PowerMeterID].PayMode =  TokenMeter[4] ;
;;;685                      }
;;;686                    //
;;;687    		if ( MeterMBCmd == MDBS_METER_GET_STATUS)
;;;688    		{
;;;689    		    MeterData[u8PowerMeterID].UserStatus =  TokenMeter[4] ;
;;;690                      }
;;;691    
;;;692                    //
;;;693    		if ( MeterMBCmd == MDBS_METER_GET_CARD_ID)
;;;694    		{
;;;695    		    MeterData[u8PowerMeterID].UserUID=  (TokenMeter[3] << 24) + (TokenMeter[4] << 16) + (TokenMeter[5] << 8) + TokenMeter[6] ;;
;;;696                      }
;;;697    	}
;;;698    	
;;;699    	
;;;700    }
000010  bd30              POP      {r4,r5,pc}
                  |L2.18|
000012  4bf8              LDR      r3,|L2.1012|
000014  69db              LDR      r3,[r3,#0x1c]         ;435
000016  2401              MOVS     r4,#1                 ;435
000018  4063              EORS     r3,r3,r4              ;435
00001a  4cf6              LDR      r4,|L2.1012|
00001c  61e3              STR      r3,[r4,#0x1c]         ;435
00001e  4bf4              LDR      r3,|L2.1008|
000020  785b              LDRB     r3,[r3,#1]            ;436  ; TokenMeter
000022  2b03              CMP      r3,#3                 ;436
000024  d176              BNE      |L2.276|
000026  4bf4              LDR      r3,|L2.1016|
000028  781b              LDRB     r3,[r3,#0]            ;439  ; MeterMBCmd
00002a  2b01              CMP      r3,#1                 ;439
00002c  d173              BNE      |L2.278|
00002e  4bf3              LDR      r3,|L2.1020|
000030  781b              LDRB     r3,[r3,#0]            ;441  ; MeterType
000032  2b01              CMP      r3,#1                 ;441
000034  d004              BEQ      |L2.64|
000036  2b02              CMP      r3,#2                 ;441
000038  d011              BEQ      |L2.94|
00003a  2b03              CMP      r3,#3                 ;441
00003c  d12d              BNE      |L2.154|
00003e  e01d              B        |L2.124|
                  |L2.64|
000040  4beb              LDR      r3,|L2.1008|
000042  795b              LDRB     r3,[r3,#5]            ;444  ; TokenMeter
000044  061b              LSLS     r3,r3,#24             ;444
000046  4cea              LDR      r4,|L2.1008|
000048  79a4              LDRB     r4,[r4,#6]            ;444  ; TokenMeter
00004a  0424              LSLS     r4,r4,#16             ;444
00004c  191b              ADDS     r3,r3,r4              ;444
00004e  4ce8              LDR      r4,|L2.1008|
000050  78e4              LDRB     r4,[r4,#3]            ;444  ; TokenMeter
000052  0224              LSLS     r4,r4,#8              ;444
000054  191b              ADDS     r3,r3,r4              ;444
000056  4ce6              LDR      r4,|L2.1008|
000058  7924              LDRB     r4,[r4,#4]            ;444  ; TokenMeter
00005a  1919              ADDS     r1,r3,r4              ;444
00005c  e02c              B        |L2.184|
                  |L2.94|
00005e  4be4              LDR      r3,|L2.1008|
000060  78db              LDRB     r3,[r3,#3]            ;447  ; TokenMeter
000062  061b              LSLS     r3,r3,#24             ;447
000064  4ce2              LDR      r4,|L2.1008|
000066  7924              LDRB     r4,[r4,#4]            ;447  ; TokenMeter
000068  0424              LSLS     r4,r4,#16             ;447
00006a  191b              ADDS     r3,r3,r4              ;447
00006c  4ce0              LDR      r4,|L2.1008|
00006e  7964              LDRB     r4,[r4,#5]            ;447  ; TokenMeter
000070  0224              LSLS     r4,r4,#8              ;447
000072  191b              ADDS     r3,r3,r4              ;447
000074  4cde              LDR      r4,|L2.1008|
000076  79a4              LDRB     r4,[r4,#6]            ;447  ; TokenMeter
000078  1919              ADDS     r1,r3,r4              ;447
00007a  e01d              B        |L2.184|
                  |L2.124|
00007c  4bdc              LDR      r3,|L2.1008|
00007e  795b              LDRB     r3,[r3,#5]            ;450  ; TokenMeter
000080  061b              LSLS     r3,r3,#24             ;450
000082  4cdb              LDR      r4,|L2.1008|
000084  79a4              LDRB     r4,[r4,#6]            ;450  ; TokenMeter
000086  0424              LSLS     r4,r4,#16             ;450
000088  191b              ADDS     r3,r3,r4              ;450
00008a  4cd9              LDR      r4,|L2.1008|
00008c  78e4              LDRB     r4,[r4,#3]            ;450  ; TokenMeter
00008e  0224              LSLS     r4,r4,#8              ;450
000090  191b              ADDS     r3,r3,r4              ;450
000092  4cd7              LDR      r4,|L2.1008|
000094  7924              LDRB     r4,[r4,#4]            ;450  ; TokenMeter
000096  1919              ADDS     r1,r3,r4              ;450
000098  e00e              B        |L2.184|
                  |L2.154|
00009a  4bd5              LDR      r3,|L2.1008|
00009c  795b              LDRB     r3,[r3,#5]            ;453  ; TokenMeter
00009e  061b              LSLS     r3,r3,#24             ;453
0000a0  4cd3              LDR      r4,|L2.1008|
0000a2  79a4              LDRB     r4,[r4,#6]            ;453  ; TokenMeter
0000a4  0424              LSLS     r4,r4,#16             ;453
0000a6  191b              ADDS     r3,r3,r4              ;453
0000a8  4cd1              LDR      r4,|L2.1008|
0000aa  78e4              LDRB     r4,[r4,#3]            ;453  ; TokenMeter
0000ac  0224              LSLS     r4,r4,#8              ;453
0000ae  191b              ADDS     r3,r3,r4              ;453
0000b0  4ccf              LDR      r4,|L2.1008|
0000b2  7924              LDRB     r4,[r4,#4]            ;453  ; TokenMeter
0000b4  1919              ADDS     r1,r3,r4              ;453
0000b6  bf00              NOP                            ;454
                  |L2.184|
0000b8  bf00              NOP                            ;445
0000ba  2324              MOVS     r3,#0x24              ;458
0000bc  4343              MULS     r3,r0,r3              ;458
0000be  4cd0              LDR      r4,|L2.1024|
0000c0  191b              ADDS     r3,r3,r4              ;458
0000c2  685b              LDR      r3,[r3,#4]            ;458
0000c4  4ccf              LDR      r4,|L2.1028|
0000c6  6023              STR      r3,[r4,#0]            ;458  ; MeterPowerValue_Now
0000c8  4bcf              LDR      r3,|L2.1032|
0000ca  781b              LDRB     r3,[r3,#0]            ;460  ; PowerOnReadMeter
0000cc  2b00              CMP      r3,#0                 ;460
0000ce  d018              BEQ      |L2.258|
0000d0  2300              MOVS     r3,#0                 ;462
0000d2  4ccd              LDR      r4,|L2.1032|
0000d4  7023              STRB     r3,[r4,#0]            ;462
0000d6  4bcb              LDR      r3,|L2.1028|
0000d8  6019              STR      r1,[r3,#0]            ;463  ; MeterPowerValue_Now
0000da  681b              LDR      r3,[r3,#0]            ;464  ; MeterPowerValue_Now
0000dc  0084              LSLS     r4,r0,#2              ;464
0000de  4dcb              LDR      r5,|L2.1036|
0000e0  512b              STR      r3,[r5,r4]            ;464
0000e2  4bc8              LDR      r3,|L2.1028|
0000e4  681c              LDR      r4,[r3,#0]            ;465  ; MeterPowerValue_Now
0000e6  2324              MOVS     r3,#0x24              ;465
0000e8  4343              MULS     r3,r0,r3              ;465
0000ea  4dc5              LDR      r5,|L2.1024|
0000ec  195b              ADDS     r3,r3,r5              ;465
0000ee  605c              STR      r4,[r3,#4]            ;465
0000f0  4bc7              LDR      r3,|L2.1040|
0000f2  781b              LDRB     r3,[r3,#0]            ;467  ; RoomData
0000f4  2404              MOVS     r4,#4                 ;467
0000f6  43a3              BICS     r3,r3,r4              ;467
0000f8  4cc5              LDR      r4,|L2.1040|
0000fa  7023              STRB     r3,[r4,#0]            ;467
0000fc  2300              MOVS     r3,#0                 ;468
0000fe  4cc5              LDR      r4,|L2.1044|
000100  5423              STRB     r3,[r4,r0]            ;468
                  |L2.258|
000102  4bc0              LDR      r3,|L2.1028|
000104  681b              LDR      r3,[r3,#0]            ;471  ; MeterPowerValue_Now
000106  4299              CMP      r1,r3                 ;471
000108  d342              BCC      |L2.400|
00010a  4bbe              LDR      r3,|L2.1028|
00010c  681b              LDR      r3,[r3,#0]            ;474  ; MeterPowerValue_Now
00010e  4299              CMP      r1,r3                 ;474
000110  d102              BNE      |L2.280|
000112  e77d              B        |L2.16|
                  |L2.276|
000114  e1f8              B        |L2.1288|
                  |L2.278|
000116  e03a              B        |L2.398|
                  |L2.280|
000118  4bba              LDR      r3,|L2.1028|
00011a  681b              LDR      r3,[r3,#0]            ;476  ; MeterPowerValue_Now
00011c  1aca              SUBS     r2,r1,r3              ;476
00011e  2ac8              CMP      r2,#0xc8              ;478
000120  d216              BCS      |L2.336|
000122  4bb8              LDR      r3,|L2.1028|
000124  6019              STR      r1,[r3,#0]            ;480  ; MeterPowerValue_Now
000126  681b              LDR      r3,[r3,#0]            ;481  ; MeterPowerValue_Now
000128  0084              LSLS     r4,r0,#2              ;481
00012a  4db8              LDR      r5,|L2.1036|
00012c  512b              STR      r3,[r5,r4]            ;481
00012e  4bb5              LDR      r3,|L2.1028|
000130  681c              LDR      r4,[r3,#0]            ;482  ; MeterPowerValue_Now
000132  2324              MOVS     r3,#0x24              ;482
000134  4343              MULS     r3,r0,r3              ;482
000136  4db2              LDR      r5,|L2.1024|
000138  195b              ADDS     r3,r3,r5              ;482
00013a  605c              STR      r4,[r3,#4]            ;482
00013c  4bb4              LDR      r3,|L2.1040|
00013e  781b              LDRB     r3,[r3,#0]            ;483  ; RoomData
000140  2404              MOVS     r4,#4                 ;483
000142  43a3              BICS     r3,r3,r4              ;483
000144  4cb2              LDR      r4,|L2.1040|
000146  7023              STRB     r3,[r4,#0]            ;483
000148  2300              MOVS     r3,#0                 ;484
00014a  4cb2              LDR      r4,|L2.1044|
00014c  5423              STRB     r3,[r4,r0]            ;484
00014e  e03e              B        |L2.462|
                  |L2.336|
000150  4bb0              LDR      r3,|L2.1044|
000152  5c1b              LDRB     r3,[r3,r0]            ;486
000154  1c5b              ADDS     r3,r3,#1              ;486
000156  4caf              LDR      r4,|L2.1044|
000158  5423              STRB     r3,[r4,r0]            ;486
00015a  4623              MOV      r3,r4                 ;487
00015c  5c1b              LDRB     r3,[r3,r0]            ;487
00015e  2b03              CMP      r3,#3                 ;487
000160  dd35              BLE      |L2.462|
000162  4ba8              LDR      r3,|L2.1028|
000164  6019              STR      r1,[r3,#0]            ;489  ; MeterPowerValue_Now
000166  681b              LDR      r3,[r3,#0]            ;490  ; MeterPowerValue_Now
000168  0084              LSLS     r4,r0,#2              ;490
00016a  4da8              LDR      r5,|L2.1036|
00016c  512b              STR      r3,[r5,r4]            ;490
00016e  2300              MOVS     r3,#0                 ;491
000170  4ca8              LDR      r4,|L2.1044|
000172  5423              STRB     r3,[r4,r0]            ;491
000174  4ba3              LDR      r3,|L2.1028|
000176  681c              LDR      r4,[r3,#0]            ;492  ; MeterPowerValue_Now
000178  2324              MOVS     r3,#0x24              ;492
00017a  4343              MULS     r3,r0,r3              ;492
00017c  4da0              LDR      r5,|L2.1024|
00017e  195b              ADDS     r3,r3,r5              ;492
000180  605c              STR      r4,[r3,#4]            ;492
000182  4ba3              LDR      r3,|L2.1040|
000184  781b              LDRB     r3,[r3,#0]            ;494  ; RoomData
000186  2404              MOVS     r4,#4                 ;494
000188  43a3              BICS     r3,r3,r4              ;494
00018a  4ca1              LDR      r4,|L2.1040|
00018c  7023              STRB     r3,[r4,#0]            ;494
                  |L2.398|
00018e  e01e              B        |L2.462|
                  |L2.400|
000190  4ba0              LDR      r3,|L2.1044|
000192  5c1b              LDRB     r3,[r3,r0]            ;500
000194  1c5b              ADDS     r3,r3,#1              ;500
000196  4c9f              LDR      r4,|L2.1044|
000198  5423              STRB     r3,[r4,r0]            ;500
00019a  4623              MOV      r3,r4                 ;501
00019c  5c1b              LDRB     r3,[r3,r0]            ;501
00019e  2b03              CMP      r3,#3                 ;501
0001a0  dd15              BLE      |L2.462|
0001a2  4b98              LDR      r3,|L2.1028|
0001a4  6019              STR      r1,[r3,#0]            ;503  ; MeterPowerValue_Now
0001a6  681b              LDR      r3,[r3,#0]            ;504  ; MeterPowerValue_Now
0001a8  0084              LSLS     r4,r0,#2              ;504
0001aa  4d98              LDR      r5,|L2.1036|
0001ac  512b              STR      r3,[r5,r4]            ;504
0001ae  4b95              LDR      r3,|L2.1028|
0001b0  681c              LDR      r4,[r3,#0]            ;505  ; MeterPowerValue_Now
0001b2  2324              MOVS     r3,#0x24              ;505
0001b4  4343              MULS     r3,r0,r3              ;505
0001b6  4d92              LDR      r5,|L2.1024|
0001b8  195b              ADDS     r3,r3,r5              ;505
0001ba  605c              STR      r4,[r3,#4]            ;505
0001bc  2300              MOVS     r3,#0                 ;508
0001be  4c95              LDR      r4,|L2.1044|
0001c0  5423              STRB     r3,[r4,r0]            ;508
0001c2  4b93              LDR      r3,|L2.1040|
0001c4  781b              LDRB     r3,[r3,#0]            ;509  ; RoomData
0001c6  2404              MOVS     r4,#4                 ;509
0001c8  43a3              BICS     r3,r3,r4              ;509
0001ca  4c91              LDR      r4,|L2.1040|
0001cc  7023              STRB     r3,[r4,#0]            ;509
                  |L2.462|
0001ce  4b8a              LDR      r3,|L2.1016|
0001d0  781b              LDRB     r3,[r3,#0]            ;515  ; MeterMBCmd
0001d2  2b05              CMP      r3,#5                 ;515
0001d4  d14e              BNE      |L2.628|
0001d6  4b89              LDR      r3,|L2.1020|
0001d8  781b              LDRB     r3,[r3,#0]            ;517  ; MeterType
0001da  2b01              CMP      r3,#1                 ;517
0001dc  d004              BEQ      |L2.488|
0001de  2b02              CMP      r3,#2                 ;517
0001e0  d018              BEQ      |L2.532|
0001e2  2b03              CMP      r3,#3                 ;517
0001e4  d145              BNE      |L2.626|
0001e6  e02e              B        |L2.582|
                  |L2.488|
0001e8  4b81              LDR      r3,|L2.1008|
0001ea  791b              LDRB     r3,[r3,#4]            ;521  ; TokenMeter
0001ec  2b00              CMP      r3,#0                 ;521
0001ee  d108              BNE      |L2.514|
0001f0  2301              MOVS     r3,#1                 ;523
0001f2  4c89              LDR      r4,|L2.1048|
0001f4  7023              STRB     r3,[r4,#0]            ;523
0001f6  2402              MOVS     r4,#2                 ;524
0001f8  2324              MOVS     r3,#0x24              ;524
0001fa  4343              MULS     r3,r0,r3              ;524
0001fc  4d80              LDR      r5,|L2.1024|
0001fe  54ec              STRB     r4,[r5,r3]            ;524
000200  e007              B        |L2.530|
                  |L2.514|
000202  2300              MOVS     r3,#0                 ;527
000204  4c84              LDR      r4,|L2.1048|
000206  7023              STRB     r3,[r4,#0]            ;527
000208  2401              MOVS     r4,#1                 ;528
00020a  2324              MOVS     r3,#0x24              ;528
00020c  4343              MULS     r3,r0,r3              ;528
00020e  4d7c              LDR      r5,|L2.1024|
000210  54ec              STRB     r4,[r5,r3]            ;528
                  |L2.530|
000212  e02e              B        |L2.626|
                  |L2.532|
000214  4b76              LDR      r3,|L2.1008|
000216  791b              LDRB     r3,[r3,#4]            ;534  ; TokenMeter
000218  2b01              CMP      r3,#1                 ;534
00021a  d107              BNE      |L2.556|
00021c  2401              MOVS     r4,#1                 ;537
00021e  2324              MOVS     r3,#0x24              ;537
000220  4343              MULS     r3,r0,r3              ;537
000222  4d77              LDR      r5,|L2.1024|
000224  54ec              STRB     r4,[r5,r3]            ;537
000226  2301              MOVS     r3,#1                 ;538
000228  4c7b              LDR      r4,|L2.1048|
00022a  7023              STRB     r3,[r4,#0]            ;538
                  |L2.556|
00022c  4b70              LDR      r3,|L2.1008|
00022e  791b              LDRB     r3,[r3,#4]            ;541  ; TokenMeter
000230  2b02              CMP      r3,#2                 ;541
000232  d107              BNE      |L2.580|
000234  2402              MOVS     r4,#2                 ;544
000236  2324              MOVS     r3,#0x24              ;544
000238  4343              MULS     r3,r0,r3              ;544
00023a  4d71              LDR      r5,|L2.1024|
00023c  54ec              STRB     r4,[r5,r3]            ;544
00023e  2300              MOVS     r3,#0                 ;545
000240  4c75              LDR      r4,|L2.1048|
000242  7023              STRB     r3,[r4,#0]            ;545
                  |L2.580|
000244  e015              B        |L2.626|
                  |L2.582|
000246  4b6a              LDR      r3,|L2.1008|
000248  791b              LDRB     r3,[r3,#4]            ;551  ; TokenMeter
00024a  2b00              CMP      r3,#0                 ;551
00024c  d108              BNE      |L2.608|
00024e  2402              MOVS     r4,#2                 ;554
000250  2324              MOVS     r3,#0x24              ;554
000252  4343              MULS     r3,r0,r3              ;554
000254  4d6a              LDR      r5,|L2.1024|
000256  54ec              STRB     r4,[r5,r3]            ;554
000258  2300              MOVS     r3,#0                 ;555
00025a  4c6f              LDR      r4,|L2.1048|
00025c  7023              STRB     r3,[r4,#0]            ;555
00025e  e007              B        |L2.624|
                  |L2.608|
000260  2401              MOVS     r4,#1                 ;559
000262  2324              MOVS     r3,#0x24              ;559
000264  4343              MULS     r3,r0,r3              ;559
000266  4d66              LDR      r5,|L2.1024|
000268  54ec              STRB     r4,[r5,r3]            ;559
00026a  2301              MOVS     r3,#1                 ;560
00026c  4c6a              LDR      r4,|L2.1048|
00026e  7023              STRB     r3,[r4,#0]            ;560
                  |L2.624|
000270  bf00              NOP                            ;563
                  |L2.626|
000272  bf00              NOP                            ;531
                  |L2.628|
000274  4b60              LDR      r3,|L2.1016|
000276  781b              LDRB     r3,[r3,#0]            ;568  ; MeterMBCmd
000278  2b0c              CMP      r3,#0xc               ;568
00027a  d132              BNE      |L2.738|
00027c  4b5f              LDR      r3,|L2.1020|
00027e  781b              LDRB     r3,[r3,#0]            ;570  ; MeterType
000280  2b01              CMP      r3,#1                 ;570
000282  d004              BEQ      |L2.654|
000284  2b02              CMP      r3,#2                 ;570
000286  d003              BEQ      |L2.656|
000288  2b03              CMP      r3,#3                 ;570
00028a  d129              BNE      |L2.736|
00028c  e027              B        |L2.734|
                  |L2.654|
00028e  e027              B        |L2.736|
                  |L2.656|
000290  4b57              LDR      r3,|L2.1008|
000292  78db              LDRB     r3,[r3,#3]            ;576  ; TokenMeter
000294  061b              LSLS     r3,r3,#24             ;576
000296  4c56              LDR      r4,|L2.1008|
000298  7924              LDRB     r4,[r4,#4]            ;576  ; TokenMeter
00029a  0424              LSLS     r4,r4,#16             ;576
00029c  191b              ADDS     r3,r3,r4              ;576
00029e  4c54              LDR      r4,|L2.1008|
0002a0  7964              LDRB     r4,[r4,#5]            ;576  ; TokenMeter
0002a2  0224              LSLS     r4,r4,#8              ;576
0002a4  191b              ADDS     r3,r3,r4              ;576
0002a6  4c52              LDR      r4,|L2.1008|
0002a8  79a4              LDRB     r4,[r4,#6]            ;576  ; TokenMeter
0002aa  191c              ADDS     r4,r3,r4              ;576
0002ac  2324              MOVS     r3,#0x24              ;576
0002ae  4343              MULS     r3,r0,r3              ;576
0002b0  4d53              LDR      r5,|L2.1024|
0002b2  195b              ADDS     r3,r3,r5              ;576
0002b4  61dc              STR      r4,[r3,#0x1c]         ;576
0002b6  2324              MOVS     r3,#0x24              ;578
0002b8  4343              MULS     r3,r0,r3              ;578
0002ba  462c              MOV      r4,r5                 ;578
0002bc  191b              ADDS     r3,r3,r4              ;578
0002be  69db              LDR      r3,[r3,#0x1c]         ;578
0002c0  4c56              LDR      r4,|L2.1052|
0002c2  42a3              CMP      r3,r4                 ;578
0002c4  d20a              BCS      |L2.732|
0002c6  4b56              LDR      r3,|L2.1056|
0002c8  5c1b              LDRB     r3,[r3,r0]            ;578
0002ca  2b03              CMP      r3,#3                 ;578
0002cc  d106              BNE      |L2.732|
0002ce  4b55              LDR      r3,|L2.1060|
0002d0  5c1b              LDRB     r3,[r3,r0]            ;580
0002d2  2b00              CMP      r3,#0                 ;580
0002d4  d102              BNE      |L2.732|
0002d6  2307              MOVS     r3,#7                 ;582
0002d8  4c52              LDR      r4,|L2.1060|
0002da  5423              STRB     r3,[r4,r0]            ;582
                  |L2.732|
0002dc  e000              B        |L2.736|
                  |L2.734|
0002de  bf00              NOP                            ;588
                  |L2.736|
0002e0  bf00              NOP                            ;573
                  |L2.738|
0002e2  4b45              LDR      r3,|L2.1016|
0002e4  781b              LDRB     r3,[r3,#0]            ;592  ; MeterMBCmd
0002e6  2b0d              CMP      r3,#0xd               ;592
0002e8  d11f              BNE      |L2.810|
0002ea  4b44              LDR      r3,|L2.1020|
0002ec  781b              LDRB     r3,[r3,#0]            ;594  ; MeterType
0002ee  2b01              CMP      r3,#1                 ;594
0002f0  d004              BEQ      |L2.764|
0002f2  2b02              CMP      r3,#2                 ;594
0002f4  d003              BEQ      |L2.766|
0002f6  2b03              CMP      r3,#3                 ;594
0002f8  d116              BNE      |L2.808|
0002fa  e014              B        |L2.806|
                  |L2.764|
0002fc  e014              B        |L2.808|
                  |L2.766|
0002fe  4b3c              LDR      r3,|L2.1008|
000300  78db              LDRB     r3,[r3,#3]            ;599  ; TokenMeter
000302  061b              LSLS     r3,r3,#24             ;599
000304  4c3a              LDR      r4,|L2.1008|
000306  7924              LDRB     r4,[r4,#4]            ;599  ; TokenMeter
000308  0424              LSLS     r4,r4,#16             ;599
00030a  191b              ADDS     r3,r3,r4              ;599
00030c  4c38              LDR      r4,|L2.1008|
00030e  7964              LDRB     r4,[r4,#5]            ;599  ; TokenMeter
000310  0224              LSLS     r4,r4,#8              ;599
000312  191b              ADDS     r3,r3,r4              ;599
000314  4c36              LDR      r4,|L2.1008|
000316  79a4              LDRB     r4,[r4,#6]            ;599  ; TokenMeter
000318  191c              ADDS     r4,r3,r4              ;599
00031a  2324              MOVS     r3,#0x24              ;599
00031c  4343              MULS     r3,r0,r3              ;599
00031e  4d38              LDR      r5,|L2.1024|
000320  195b              ADDS     r3,r3,r5              ;599
000322  609c              STR      r4,[r3,#8]            ;599
000324  e000              B        |L2.808|
                  |L2.806|
000326  bf00              NOP                            ;603
                  |L2.808|
000328  bf00              NOP                            ;597
                  |L2.810|
00032a  4b33              LDR      r3,|L2.1016|
00032c  781b              LDRB     r3,[r3,#0]            ;607  ; MeterMBCmd
00032e  2b0e              CMP      r3,#0xe               ;607
000330  d11f              BNE      |L2.882|
000332  4b32              LDR      r3,|L2.1020|
000334  781b              LDRB     r3,[r3,#0]            ;609  ; MeterType
000336  2b01              CMP      r3,#1                 ;609
000338  d004              BEQ      |L2.836|
00033a  2b02              CMP      r3,#2                 ;609
00033c  d003              BEQ      |L2.838|
00033e  2b03              CMP      r3,#3                 ;609
000340  d116              BNE      |L2.880|
000342  e014              B        |L2.878|
                  |L2.836|
000344  e014              B        |L2.880|
                  |L2.838|
000346  4b2a              LDR      r3,|L2.1008|
000348  78db              LDRB     r3,[r3,#3]            ;614  ; TokenMeter
00034a  061b              LSLS     r3,r3,#24             ;614
00034c  4c28              LDR      r4,|L2.1008|
00034e  7924              LDRB     r4,[r4,#4]            ;614  ; TokenMeter
000350  0424              LSLS     r4,r4,#16             ;614
000352  191b              ADDS     r3,r3,r4              ;614
000354  4c26              LDR      r4,|L2.1008|
000356  7964              LDRB     r4,[r4,#5]            ;614  ; TokenMeter
000358  0224              LSLS     r4,r4,#8              ;614
00035a  191b              ADDS     r3,r3,r4              ;614
00035c  4c24              LDR      r4,|L2.1008|
00035e  79a4              LDRB     r4,[r4,#6]            ;614  ; TokenMeter
000360  191c              ADDS     r4,r3,r4              ;614
000362  2324              MOVS     r3,#0x24              ;614
000364  4343              MULS     r3,r0,r3              ;614
000366  4d26              LDR      r5,|L2.1024|
000368  195b              ADDS     r3,r3,r5              ;614
00036a  60dc              STR      r4,[r3,#0xc]          ;614
00036c  e000              B        |L2.880|
                  |L2.878|
00036e  bf00              NOP                            ;618
                  |L2.880|
000370  bf00              NOP                            ;612
                  |L2.882|
000372  4b21              LDR      r3,|L2.1016|
000374  781b              LDRB     r3,[r3,#0]            ;622  ; MeterMBCmd
000376  2b0f              CMP      r3,#0xf               ;622
000378  d118              BNE      |L2.940|
00037a  4b20              LDR      r3,|L2.1020|
00037c  781b              LDRB     r3,[r3,#0]            ;624  ; MeterType
00037e  2b01              CMP      r3,#1                 ;624
000380  d004              BEQ      |L2.908|
000382  2b02              CMP      r3,#2                 ;624
000384  d003              BEQ      |L2.910|
000386  2b03              CMP      r3,#3                 ;624
000388  d10f              BNE      |L2.938|
00038a  e00d              B        |L2.936|
                  |L2.908|
00038c  e00d              B        |L2.938|
                  |L2.910|
00038e  4b18              LDR      r3,|L2.1008|
000390  78db              LDRB     r3,[r3,#3]            ;629  ; TokenMeter
000392  021b              LSLS     r3,r3,#8              ;629
000394  4c16              LDR      r4,|L2.1008|
000396  7924              LDRB     r4,[r4,#4]            ;629  ; TokenMeter
000398  191b              ADDS     r3,r3,r4              ;629
00039a  b29c              UXTH     r4,r3                 ;629
00039c  2324              MOVS     r3,#0x24              ;629
00039e  4343              MULS     r3,r0,r3              ;629
0003a0  4d17              LDR      r5,|L2.1024|
0003a2  195b              ADDS     r3,r3,r5              ;629
0003a4  831c              STRH     r4,[r3,#0x18]         ;629
0003a6  e000              B        |L2.938|
                  |L2.936|
0003a8  bf00              NOP                            ;633
                  |L2.938|
0003aa  bf00              NOP                            ;627
                  |L2.940|
0003ac  4b12              LDR      r3,|L2.1016|
0003ae  781b              LDRB     r3,[r3,#0]            ;637  ; MeterMBCmd
0003b0  2b10              CMP      r3,#0x10              ;637
0003b2  d13b              BNE      |L2.1068|
0003b4  4b11              LDR      r3,|L2.1020|
0003b6  781b              LDRB     r3,[r3,#0]            ;639  ; MeterType
0003b8  2b01              CMP      r3,#1                 ;639
0003ba  d004              BEQ      |L2.966|
0003bc  2b02              CMP      r3,#2                 ;639
0003be  d003              BEQ      |L2.968|
0003c0  2b03              CMP      r3,#3                 ;639
0003c2  d132              BNE      |L2.1066|
0003c4  e030              B        |L2.1064|
                  |L2.966|
0003c6  e030              B        |L2.1066|
                  |L2.968|
0003c8  4b09              LDR      r3,|L2.1008|
0003ca  78db              LDRB     r3,[r3,#3]            ;644  ; TokenMeter
0003cc  061b              LSLS     r3,r3,#24             ;644
0003ce  4c08              LDR      r4,|L2.1008|
0003d0  7924              LDRB     r4,[r4,#4]            ;644  ; TokenMeter
0003d2  0424              LSLS     r4,r4,#16             ;644
0003d4  191b              ADDS     r3,r3,r4              ;644
0003d6  4c06              LDR      r4,|L2.1008|
0003d8  7964              LDRB     r4,[r4,#5]            ;644  ; TokenMeter
0003da  0224              LSLS     r4,r4,#8              ;644
0003dc  191b              ADDS     r3,r3,r4              ;644
0003de  4c04              LDR      r4,|L2.1008|
0003e0  79a4              LDRB     r4,[r4,#6]            ;644  ; TokenMeter
0003e2  191c              ADDS     r4,r3,r4              ;644
0003e4  2324              MOVS     r3,#0x24              ;644
0003e6  4343              MULS     r3,r0,r3              ;644
0003e8  4d05              LDR      r5,|L2.1024|
0003ea  195b              ADDS     r3,r3,r5              ;644
0003ec  611c              STR      r4,[r3,#0x10]         ;644
0003ee  e01c              B        |L2.1066|
                  |L2.1008|
                          DCD      TokenMeter
                  |L2.1012|
                          DCD      0x500042c0
                  |L2.1016|
                          DCD      MeterMBCmd
                  |L2.1020|
                          DCD      MeterType
                  |L2.1024|
                          DCD      MeterData
                  |L2.1028|
                          DCD      MeterPowerValue_Now
                  |L2.1032|
                          DCD      PowerOnReadMeter
                  |L2.1036|
                          DCD      LastMeterPower
                  |L2.1040|
                          DCD      RoomData
                  |L2.1044|
                          DCD      GapErrorTimes
                  |L2.1048|
                          DCD      MeterRelayStatus
                  |L2.1052|
                          DCD      0x0001863c
                  |L2.1056|
                          DCD      RoomMode
                  |L2.1060|
                          DCD      ModBusCommandList
                  |L2.1064|
000428  bf00              NOP                            ;648
                  |L2.1066|
00042a  bf00              NOP                            ;642
                  |L2.1068|
00042c  4b37              LDR      r3,|L2.1292|
00042e  781b              LDRB     r3,[r3,#0]            ;652  ; MeterMBCmd
000430  2b11              CMP      r3,#0x11              ;652
000432  d11f              BNE      |L2.1140|
000434  4b36              LDR      r3,|L2.1296|
000436  781b              LDRB     r3,[r3,#0]            ;654  ; MeterType
000438  2b01              CMP      r3,#1                 ;654
00043a  d004              BEQ      |L2.1094|
00043c  2b02              CMP      r3,#2                 ;654
00043e  d003              BEQ      |L2.1096|
000440  2b03              CMP      r3,#3                 ;654
000442  d116              BNE      |L2.1138|
000444  e014              B        |L2.1136|
                  |L2.1094|
000446  e014              B        |L2.1138|
                  |L2.1096|
000448  4b32              LDR      r3,|L2.1300|
00044a  78db              LDRB     r3,[r3,#3]            ;659  ; TokenMeter
00044c  061b              LSLS     r3,r3,#24             ;659
00044e  4c31              LDR      r4,|L2.1300|
000450  7924              LDRB     r4,[r4,#4]            ;659  ; TokenMeter
000452  0424              LSLS     r4,r4,#16             ;659
000454  191b              ADDS     r3,r3,r4              ;659
000456  4c2f              LDR      r4,|L2.1300|
000458  7964              LDRB     r4,[r4,#5]            ;659  ; TokenMeter
00045a  0224              LSLS     r4,r4,#8              ;659
00045c  191b              ADDS     r3,r3,r4              ;659
00045e  4c2d              LDR      r4,|L2.1300|
000460  79a4              LDRB     r4,[r4,#6]            ;659  ; TokenMeter
000462  191c              ADDS     r4,r3,r4              ;659
000464  2324              MOVS     r3,#0x24              ;659
000466  4343              MULS     r3,r0,r3              ;659
000468  4d2b              LDR      r5,|L2.1304|
00046a  195b              ADDS     r3,r3,r5              ;659
00046c  611c              STR      r4,[r3,#0x10]         ;659
00046e  e000              B        |L2.1138|
                  |L2.1136|
000470  bf00              NOP                            ;663
                  |L2.1138|
000472  bf00              NOP                            ;657
                  |L2.1140|
000474  4b25              LDR      r3,|L2.1292|
000476  781b              LDRB     r3,[r3,#0]            ;667  ; MeterMBCmd
000478  2b12              CMP      r3,#0x12              ;667
00047a  d118              BNE      |L2.1198|
00047c  4b24              LDR      r3,|L2.1296|
00047e  781b              LDRB     r3,[r3,#0]            ;669  ; MeterType
000480  2b01              CMP      r3,#1                 ;669
000482  d004              BEQ      |L2.1166|
000484  2b02              CMP      r3,#2                 ;669
000486  d003              BEQ      |L2.1168|
000488  2b03              CMP      r3,#3                 ;669
00048a  d10f              BNE      |L2.1196|
00048c  e00d              B        |L2.1194|
                  |L2.1166|
00048e  e00d              B        |L2.1196|
                  |L2.1168|
000490  4b20              LDR      r3,|L2.1300|
000492  78db              LDRB     r3,[r3,#3]            ;674  ; TokenMeter
000494  021b              LSLS     r3,r3,#8              ;674
000496  4c1f              LDR      r4,|L2.1300|
000498  7924              LDRB     r4,[r4,#4]            ;674  ; TokenMeter
00049a  191b              ADDS     r3,r3,r4              ;674
00049c  b29c              UXTH     r4,r3                 ;674
00049e  2324              MOVS     r3,#0x24              ;674
0004a0  4343              MULS     r3,r0,r3              ;674
0004a2  4d1d              LDR      r5,|L2.1304|
0004a4  195b              ADDS     r3,r3,r5              ;674
0004a6  835c              STRH     r4,[r3,#0x1a]         ;674
0004a8  e000              B        |L2.1196|
                  |L2.1194|
0004aa  bf00              NOP                            ;678
                  |L2.1196|
0004ac  bf00              NOP                            ;672
                  |L2.1198|
0004ae  4b17              LDR      r3,|L2.1292|
0004b0  781b              LDRB     r3,[r3,#0]            ;682  ; MeterMBCmd
0004b2  2b13              CMP      r3,#0x13              ;682
0004b4  d106              BNE      |L2.1220|
0004b6  4b17              LDR      r3,|L2.1300|
0004b8  791c              LDRB     r4,[r3,#4]            ;684  ; TokenMeter
0004ba  2324              MOVS     r3,#0x24              ;684
0004bc  4343              MULS     r3,r0,r3              ;684
0004be  4d16              LDR      r5,|L2.1304|
0004c0  195b              ADDS     r3,r3,r5              ;684
0004c2  705c              STRB     r4,[r3,#1]            ;684
                  |L2.1220|
0004c4  4b11              LDR      r3,|L2.1292|
0004c6  781b              LDRB     r3,[r3,#0]            ;687  ; MeterMBCmd
0004c8  2b14              CMP      r3,#0x14              ;687
0004ca  d106              BNE      |L2.1242|
0004cc  4b11              LDR      r3,|L2.1300|
0004ce  791c              LDRB     r4,[r3,#4]            ;689  ; TokenMeter
0004d0  2324              MOVS     r3,#0x24              ;689
0004d2  4343              MULS     r3,r0,r3              ;689
0004d4  4d10              LDR      r5,|L2.1304|
0004d6  195b              ADDS     r3,r3,r5              ;689
0004d8  709c              STRB     r4,[r3,#2]            ;689
                  |L2.1242|
0004da  4b0c              LDR      r3,|L2.1292|
0004dc  781b              LDRB     r3,[r3,#0]            ;693  ; MeterMBCmd
0004de  2b15              CMP      r3,#0x15              ;693
0004e0  d112              BNE      |L2.1288|
0004e2  4b0c              LDR      r3,|L2.1300|
0004e4  78db              LDRB     r3,[r3,#3]            ;695  ; TokenMeter
0004e6  061b              LSLS     r3,r3,#24             ;695
0004e8  4c0a              LDR      r4,|L2.1300|
0004ea  7924              LDRB     r4,[r4,#4]            ;695  ; TokenMeter
0004ec  0424              LSLS     r4,r4,#16             ;695
0004ee  191b              ADDS     r3,r3,r4              ;695
0004f0  4c08              LDR      r4,|L2.1300|
0004f2  7964              LDRB     r4,[r4,#5]            ;695  ; TokenMeter
0004f4  0224              LSLS     r4,r4,#8              ;695
0004f6  191b              ADDS     r3,r3,r4              ;695
0004f8  4c06              LDR      r4,|L2.1300|
0004fa  79a4              LDRB     r4,[r4,#6]            ;695  ; TokenMeter
0004fc  191c              ADDS     r4,r3,r4              ;695
0004fe  2324              MOVS     r3,#0x24              ;695
000500  4343              MULS     r3,r0,r3              ;695
000502  4d05              LDR      r5,|L2.1304|
000504  195b              ADDS     r3,r3,r5              ;695
000506  621c              STR      r4,[r3,#0x20]         ;695
                  |L2.1288|
000508  bf00              NOP      
00050a  e581              B        |L2.16|
;;;701    void CalChecksumM(void)
                          ENDP

                  |L2.1292|
                          DCD      MeterMBCmd
                  |L2.1296|
                          DCD      MeterType
                  |L2.1300|
                          DCD      TokenMeter
                  |L2.1304|
                          DCD      MeterData

                          AREA ||i.MeterPolling||, CODE, READONLY, ALIGN=2

                  MeterPolling PROC
;;;42     // Power Meter Reading 
;;;43     void MeterPolling(void)
000000  b510              PUSH     {r4,lr}
;;;44     {
;;;45     	//uint8_t i;
;;;46         if ( MeterActive != MyMeterID ) return;
000002  48fd              LDR      r0,|L3.1016|
000004  7800              LDRB     r0,[r0,#0]  ; MeterActive
000006  49fd              LDR      r1,|L3.1020|
000008  7809              LDRB     r1,[r1,#0]  ; MyMeterID
00000a  4288              CMP      r0,r1
00000c  d000              BEQ      |L3.16|
                  |L3.14|
;;;47         
;;;48         switch(MeterPollingState)
;;;49         {
;;;50             case MP_READY :
;;;51     
;;;52                 if (TickReadPowerTime >= ReadMeterTime)
;;;53                 {
;;;54                     // Polling interval Time ( ReadMeterTime x 20mSec )
;;;55                     // Normal => 1 Sec / Power Startup => 100mSec
;;;56                     TickReadPowerTime = 0 ;								
;;;57                     MeterPollingState = MP_POLLING_W_CMD+PollingStateIndex ;
;;;58                     if ( MeterPollingState > MP_POLLING_CARD_CMD )
;;;59                     {
;;;60                         MeterPollingState = MP_POLLING_W_CMD ;
;;;61                         PollingStateIndex = 0 ;
;;;62                         PollingMeterID++;
;;;63                         if ( PollingMeterID > MaxPowerMeter )
;;;64                         {
;;;65                             PollingMeterID = 1 ;
;;;66                         }                    
;;;67                     }
;;;68                     PowerMeterID = PollingMeterID ;
;;;69                 } else {
;;;70                     // Command 
;;;71                     ModBusCommand = ModBusCommandList[PollingMeterID-1] ;
;;;72                     ModBusCommandList[PollingMeterID-1] = MBCMD_READY ;
;;;73                     PowerMeterID = PollingMeterID ;
;;;74                     switch ( ModBusCommand )
;;;75                     {
;;;76                         case MBCMD_READY :
;;;77                             break;
;;;78                         case MBCMD_RELAY_ON :
;;;79                             RelayOnOff = 1 ;
;;;80                             MeterPollingState = MP_SET_RELAY1 ;
;;;81                             ModBusCommand = MBCMD_READY;
;;;82                             break;
;;;83                         case MBCMD_RELAY_OFF :										
;;;84                             RelayOnOff = 0 ;
;;;85                             MeterPollingState = MP_SET_RELAY1 ;
;;;86                             ModBusCommand = MBCMD_READY;
;;;87                             break;
;;;88                         case MBCMD_ADD_VALUE :														
;;;89                             MeterPollingState = MP_ADD_VALUE1 ;
;;;90                             ModBusCommand = MBCMD_READY;
;;;91                             break;
;;;92                         case MBCMD_EXIT_TEST :
;;;93                             MeterPollingState = MP_EXIT_TEST1 ;
;;;94                             ModBusCommand = MBCMD_READY;
;;;95                             break;
;;;96                         case MBCMD_SET_POWER_ON :
;;;97                             RelayOnOff = 1 ;
;;;98                             MeterPollingState = MP_SET_POWER_ON1 ;
;;;99                             ModBusCommand = MBCMD_READY;
;;;100                            break;
;;;101                        case MBCMD_SET_POWER_OFF :		
;;;102                            RelayOnOff = 0 ;
;;;103                            MeterPollingState = MP_SET_POWER_OFF1 ;
;;;104                            ModBusCommand = MBCMD_READY;
;;;105                            break;                        
;;;106                        case MBCMD_SET_POWER_READER :		
;;;107                            RelayOnOff = 0 ;
;;;108                            MeterPollingState = MP_SET_POWER_READER1 ;
;;;109                            ModBusCommand = MBCMD_READY;
;;;110                            break;
;;;111                        default :
;;;112                            break;
;;;113                    }
;;;114                }
;;;115                break;
;;;116            case MP_POLLING_RSP :
;;;117                if (GotMeterRsp == PowerMeterID)
;;;118                {                
;;;119                    MeterSuccess();
;;;120                } else {
;;;121                    MeterTimeoutProcess();
;;;122                }
;;;123                break;		
;;;124            case MP_POLLING_W_CMD :
;;;125                MODBUS_SendCmd(MDBS_METER_GET_WATT);
;;;126                MeterPollingState = MP_POLLING_RSP ; 
;;;127                TickPollingMeterInterval = 0 ;
;;;128                break;		
;;;129            case MP_POLLING_RELAY_CMD :	
;;;130                //if ( (RoomMode[PollingMeterID-1] == RM_FREE_MODE_READY) || (RoomMode[PollingMeterID-1] == RM_STOP_MODE_READY) )
;;;131                //{
;;;132                //    MeterPollingState = MP_READY;	
;;;133                //    PollingStateIndex++;
;;;134                //    break;
;;;135                //}
;;;136                MODBUS_SendCmd(MDBS_METER_GET_RELAY);
;;;137                MeterPollingState = MP_POLLING_RSP ; 
;;;138                TickPollingMeterInterval = 0 ;			
;;;139                break;		
;;;140            case MP_POLLING_BAL_CMD :
;;;141                if ( (RoomMode[PollingMeterID-1] == RM_FREE_MODE_READY) )
;;;142                {
;;;143                    MODBUS_SendCmd(MDBS_METER_GET_BAL);
;;;144                    MeterPollingState = MP_POLLING_RSP ; 
;;;145                    TickPollingMeterInterval = 0 ;			
;;;146                } else {
;;;147                    MeterPollingState = MP_READY;	
;;;148                    PollingStateIndex++;
;;;149                    break;
;;;150                }
;;;151                break;		
;;;152            case MP_POLLING_V_CMD :			
;;;153                MODBUS_SendCmd(MDBS_METER_GET_V);
;;;154                MeterPollingState = MP_POLLING_RSP ; 
;;;155                TickPollingMeterInterval = 0 ;			
;;;156                break;
;;;157            case MP_POLLING_I_CMD :			
;;;158                MODBUS_SendCmd(MDBS_METER_GET_I);
;;;159                MeterPollingState = MP_POLLING_RSP ; 
;;;160                TickPollingMeterInterval = 0 ;			
;;;161                break;
;;;162            case MP_POLLING_F_CMD :			
;;;163                MODBUS_SendCmd(MDBS_METER_GET_F);
;;;164                MeterPollingState = MP_POLLING_RSP ; 
;;;165                TickPollingMeterInterval = 0 ;			
;;;166                break;
;;;167            case MP_POLLING_P_CMD :			
;;;168                MODBUS_SendCmd(MDBS_METER_GET_P);
;;;169                MeterPollingState = MP_POLLING_RSP ; 
;;;170                TickPollingMeterInterval = 0 ;			
;;;171                break;
;;;172            case MP_POLLING_S_CMD :			
;;;173                MODBUS_SendCmd(MDBS_METER_GET_S);
;;;174                MeterPollingState = MP_POLLING_RSP ; 
;;;175                TickPollingMeterInterval = 0 ;			
;;;176                break;
;;;177            case MP_POLLING_PF_CMD :			
;;;178                MODBUS_SendCmd(MDBS_METER_GET_PF);
;;;179                MeterPollingState = MP_POLLING_RSP ; 
;;;180                TickPollingMeterInterval = 0 ;			
;;;181                break;
;;;182            case MP_POLLING_PAY_CMD :
;;;183                
;;;184                    MODBUS_SendCmd(MDBS_METER_GET_MODE);
;;;185                    MeterPollingState = MP_POLLING_RSP ; 
;;;186                    TickPollingMeterInterval = 0 ;	
;;;187                    break;
;;;188            case MP_POLLING_STATUS_CMD :			
;;;189                MODBUS_SendCmd(MDBS_METER_GET_STATUS);
;;;190                MeterPollingState = MP_POLLING_RSP ; 
;;;191                TickPollingMeterInterval = 0 ;			
;;;192                break;
;;;193            case MP_POLLING_CARD_CMD :			
;;;194                MODBUS_SendCmd(MDBS_METER_GET_CARD_ID);
;;;195                MeterPollingState = MP_POLLING_RSP ; 
;;;196                TickPollingMeterInterval = 0 ;			
;;;197                break;
;;;198            case MP_SET_RELAY1 :
;;;199                MODBUS_SendCmd(MDBS_METER_SET_PWD);
;;;200                MeterPollingState = MP_SET_RELAY2;
;;;201                DelayTime4NextCmd = 0 ;					
;;;202                break;
;;;203            case MP_SET_RELAY2 :			
;;;204                if ( DelayTime4NextCmd > 40 ) 
;;;205                {
;;;206                DelayTime4NextCmd = 0 ;				
;;;207                // BAW2A => 1 : ON   2 : OFF				
;;;208                MODBUS_SendCmd(MDBS_METER_SET_RELAY);
;;;209                MeterPollingState = MP_READY ;				
;;;210                }
;;;211                break;		
;;;212            case MP_ADD_VALUE1 :						
;;;213                MODBUS_SendCmd(MDBS_METER_SET_PWD);
;;;214                MeterPollingState = MP_ADD_VALUE2;
;;;215                DelayTime4NextCmd = 0 ;						
;;;216                break;
;;;217            case MP_ADD_VALUE2 :			
;;;218                if ( DelayTime4NextCmd > 30 ) 
;;;219                {
;;;220                    DelayTime4NextCmd = 0 ;				
;;;221                    // BAW2A					
;;;222                    MODBUS_SendCmd(MDBS_METER_ADD_VALUE);
;;;223                    MeterPollingState = MP_READY ;				
;;;224                }
;;;225                break;		
;;;226            case MP_EXIT_TEST1 :						
;;;227                MODBUS_SendCmd(MDBS_METER_SET_PWD);
;;;228                MeterPollingState = MP_EXIT_TEST2;
;;;229                DelayTime4NextCmd = 0 ;						
;;;230                break;
;;;231            case MP_EXIT_TEST2 :			
;;;232                if ( DelayTime4NextCmd > 30 ) 
;;;233                {
;;;234                    DelayTime4NextCmd = 0 ;															
;;;235                    // BAW2A				
;;;236                    MODBUS_SendCmd(MDBS_METER_EXIT_TEST);
;;;237                    MeterPollingState = MP_READY ;				
;;;238                }
;;;239                break;			
;;;240            case MP_SET_POWER_ON1 :			
;;;241                DelayTime4NextCmd = 0 ;	
;;;242                Tick5mS_CheckRoomMode = 0 ;
;;;243    					  MODBUS_SendCmd(MDBS_METER_SET_PWD);
;;;244                MeterPollingState = MP_SET_POWER_ON2;	
;;;245                break;
;;;246            case MP_SET_POWER_ON2 :			
;;;247                if ( DelayTime4NextCmd > 50 ) 
;;;248                {
;;;249                    // BAW2A	
;;;250                    DelayTime4NextCmd = 0 ;																		
;;;251                    PayMode = 0x00;                 // Card reader Disable (Meter)
;;;252                    MeterPollingState = MP_SET_POWER_ON3 ;
;;;253                    Tick5mS_CheckRoomMode = 0 ;
;;;254                    MODBUS_SendCmd(MDBS_METER_SET_MODE);
;;;255                }
;;;256                break;
;;;257             case MP_SET_POWER_ON3 :			
;;;258                if ( DelayTime4NextCmd > 50 ) 
;;;259                {
;;;260                    // BAW2A	
;;;261                    DelayTime4NextCmd = 0 ;																		                
;;;262                    MeterPollingState = MP_SET_POWER_ON4 ;	
;;;263                    Tick5mS_CheckRoomMode = 0 ;
;;;264                    MODBUS_SendCmd(MDBS_METER_SET_PWD);
;;;265                }
;;;266                break;
;;;267            case MP_SET_POWER_ON4 :			
;;;268                if ( DelayTime4NextCmd > 50 ) 
;;;269                {
;;;270                    // BAW2A	
;;;271                    DelayTime4NextCmd = 0 ;                
;;;272                    MeterPollingState = MP_SET_POWER_ON5 ;	
;;;273                    Tick5mS_CheckRoomMode = 0 ;
;;;274                    MODBUS_SendCmd(MDBS_METER_ADD_VALUE);
;;;275                }
;;;276                break;
;;;277            case MP_SET_POWER_ON5 :			
;;;278                if ( DelayTime4NextCmd > 50 ) 
;;;279                {
;;;280                    // BAW2A	
;;;281                    DelayTime4NextCmd = 0 ;																		                
;;;282                    MeterPollingState = MP_SET_POWER_ON6 ;	
;;;283                    Tick5mS_CheckRoomMode = 0 ;
;;;284                    MODBUS_SendCmd(MDBS_METER_SET_PWD);
;;;285                }
;;;286                break;
;;;287            case MP_SET_POWER_ON6 :			
;;;288                if ( DelayTime4NextCmd > 50 ) 
;;;289                {
;;;290                    // BAW2A	
;;;291                    DelayTime4NextCmd = 0 ;
;;;292                    RelayOnOff = 1 ; // ON
;;;293                    MeterPollingState = MP_READY ;	
;;;294                    Tick5mS_CheckRoomMode = 0 ;
;;;295                    MODBUS_SendCmd(MDBS_METER_SET_RELAY);
;;;296                }
;;;297                break;
;;;298            case MP_SET_POWER_OFF1 :			
;;;299    	   MeterPollingState = MP_SET_POWER_OFF2;
;;;300                DelayTime4NextCmd = 0 ;
;;;301                Tick5mS_CheckRoomMode = 0 ;
;;;302                MODBUS_SendCmd(MDBS_METER_SET_PWD);
;;;303                break;
;;;304            case MP_SET_POWER_OFF2 :			
;;;305                if ( DelayTime4NextCmd > 50 ) 
;;;306                {
;;;307                    DelayTime4NextCmd = 0 ;															
;;;308                    // BAW2A			
;;;309                    PayMode = 0x00;     // Card reader Disable (Meter)
;;;310                    Tick5mS_CheckRoomMode = 0 ;
;;;311                    MODBUS_SendCmd(MDBS_METER_SET_MODE);
;;;312                    MeterPollingState = MP_SET_POWER_OFF5 ;				
;;;313                }
;;;314                break;		
;;;315            case MP_SET_POWER_OFF3 :			
;;;316                if ( DelayTime4NextCmd > 50 ) 
;;;317                {
;;;318                    DelayTime4NextCmd = 0 ;															
;;;319                    // BAW2A				                
;;;320                    Tick5mS_CheckRoomMode = 0 ;
;;;321                    MODBUS_SendCmd(MDBS_METER_SET_PWD);
;;;322                    MeterPollingState = MP_SET_POWER_OFF4 ;				
;;;323                }
;;;324                break;	
;;;325            case MP_SET_POWER_OFF4 :			
;;;326                if ( DelayTime4NextCmd > 50 ) 
;;;327                {
;;;328                    MeterPollingState = MP_SET_POWER_OFF5 ;
;;;329                    DelayTime4NextCmd = 0 ;                
;;;330                    Tick5mS_CheckRoomMode = 0 ;
;;;331                    MODBUS_SendCmd(MDBS_METER_ADD_VALUE);		
;;;332                }
;;;333                break;		
;;;334            case MP_SET_POWER_OFF5 :			
;;;335                if ( DelayTime4NextCmd > 50 ) 
;;;336                {
;;;337                    DelayTime4NextCmd = 0 ;															
;;;338                    // BAW2A				             
;;;339                    Tick5mS_CheckRoomMode = 0 ;
;;;340                    MODBUS_SendCmd(MDBS_METER_SET_PWD);
;;;341                    MeterPollingState = MP_SET_POWER_OFF6 ;				
;;;342                }
;;;343                break;	
;;;344            case MP_SET_POWER_OFF6 :			
;;;345                if ( DelayTime4NextCmd > 50 ) 
;;;346                {
;;;347                    MeterPollingState = MP_READY ;
;;;348                    DelayTime4NextCmd = 0 ;
;;;349                    RelayOnOff = 0 ; // OFF
;;;350                    Tick5mS_CheckRoomMode = 0 ;
;;;351                    MODBUS_SendCmd(MDBS_METER_SET_RELAY);		
;;;352                }
;;;353                break;		
;;;354            case MP_SET_POWER_READER1 :						
;;;355                MODBUS_SendCmd(MDBS_METER_SET_PWD);
;;;356                MeterPollingState = MP_SET_POWER_READER2;
;;;357                DelayTime4NextCmd = 0 ;						
;;;358                break;
;;;359            case MP_SET_POWER_READER2 :			
;;;360                if ( DelayTime4NextCmd > 50 ) 
;;;361                {
;;;362                    DelayTime4NextCmd = 0 ;															
;;;363                    // BAW2A	
;;;364                    RelayOnOff = 0 ;    // OFF
;;;365                    MODBUS_SendCmd(MDBS_METER_SET_RELAY);
;;;366                    MeterPollingState = MP_SET_POWER_READER3 ;						
;;;367                }
;;;368                break;		
;;;369            case MP_SET_POWER_READER3 :			
;;;370                if ( DelayTime4NextCmd > 50 ) 
;;;371                {
;;;372                    DelayTime4NextCmd = 0 ;															
;;;373                    // BAW2A				                
;;;374                    MODBUS_SendCmd(MDBS_METER_SET_PWD);
;;;375                    MeterPollingState = MP_SET_POWER_READER4 ;				
;;;376                }
;;;377                break;	
;;;378            case MP_SET_POWER_READER4 :			
;;;379                if ( DelayTime4NextCmd > 50 ) 
;;;380                {
;;;381                    DelayTime4NextCmd = 0 ;
;;;382                    // BAW2A		                
;;;383                    PayMode = 0x01;     // Card reader Enable ( Reader )
;;;384                    MODBUS_SendCmd(MDBS_METER_SET_MODE);
;;;385                    MeterPollingState = MP_READY ;	
;;;386                    	
;;;387                }
;;;388                break;		
;;;389            default :
;;;390                MeterPollingState = MP_READY ;
;;;391                break;
;;;392        }
;;;393    
;;;394    }
00000e  bd10              POP      {r4,pc}
                  |L3.16|
000010  48fb              LDR      r0,|L3.1024|
000012  7800              LDRB     r0,[r0,#0]            ;48  ; MeterPollingState
000014  0003              MOVS     r3,r0                 ;48
000016  f7fffffe          BL       __ARM_common_switch8
00001a  2715              DCB      0x27,0x15
00001c  a0acb6c0          DCB      0xa0,0xac,0xb6,0xc0
000020  fbefeeed          DCB      0xfb,0xef,0xee,0xed
000024  ecebeae9          DCB      0xec,0xeb,0xea,0xe9
000028  e8e7e6e5          DCB      0xe8,0xe7,0xe6,0xe5
00002c  e4e3e5e2          DCB      0xe4,0xe3,0xe5,0xe2
000030  e1e5e0df          DCB      0xe1,0xe5,0xe0,0xdf
000034  dedddcdb          DCB      0xde,0xdd,0xdc,0xdb
000038  dad9d8d7          DCB      0xda,0xd9,0xd8,0xd7
00003c  d6d5d4d3          DCB      0xd6,0xd5,0xd4,0xd3
000040  d2d1e500          DCB      0xd2,0xd1,0xe5,0x00
000044  48ef              LDR      r0,|L3.1028|
000046  8800              LDRH     r0,[r0,#0]            ;52  ; TickReadPowerTime
000048  49ef              LDR      r1,|L3.1032|
00004a  8809              LDRH     r1,[r1,#0]            ;52  ; ReadMeterTime
00004c  4288              CMP      r0,r1                 ;52
00004e  db23              BLT      |L3.152|
000050  2000              MOVS     r0,#0                 ;56
000052  49ec              LDR      r1,|L3.1028|
000054  8008              STRH     r0,[r1,#0]            ;56
000056  48ed              LDR      r0,|L3.1036|
000058  7800              LDRB     r0,[r0,#0]            ;57  ; PollingStateIndex
00005a  1c80              ADDS     r0,r0,#2              ;57
00005c  49e8              LDR      r1,|L3.1024|
00005e  7008              STRB     r0,[r1,#0]            ;57
000060  4608              MOV      r0,r1                 ;58
000062  7800              LDRB     r0,[r0,#0]            ;58  ; MeterPollingState
000064  280d              CMP      r0,#0xd               ;58
000066  dd12              BLE      |L3.142|
000068  2002              MOVS     r0,#2                 ;60
00006a  7008              STRB     r0,[r1,#0]            ;60
00006c  2000              MOVS     r0,#0                 ;61
00006e  49e7              LDR      r1,|L3.1036|
000070  7008              STRB     r0,[r1,#0]            ;61
000072  48e7              LDR      r0,|L3.1040|
000074  7800              LDRB     r0,[r0,#0]            ;62  ; PollingMeterID
000076  1c40              ADDS     r0,r0,#1              ;62
000078  49e5              LDR      r1,|L3.1040|
00007a  7008              STRB     r0,[r1,#0]            ;62
00007c  4608              MOV      r0,r1                 ;63
00007e  7800              LDRB     r0,[r0,#0]            ;63  ; PollingMeterID
000080  49e4              LDR      r1,|L3.1044|
000082  7809              LDRB     r1,[r1,#0]            ;63  ; MaxPowerMeter
000084  4288              CMP      r0,r1                 ;63
000086  dd02              BLE      |L3.142|
000088  2001              MOVS     r0,#1                 ;65
00008a  49e1              LDR      r1,|L3.1040|
00008c  7008              STRB     r0,[r1,#0]            ;65
                  |L3.142|
00008e  48e0              LDR      r0,|L3.1040|
000090  7800              LDRB     r0,[r0,#0]            ;68  ; PollingMeterID
000092  49e1              LDR      r1,|L3.1048|
000094  7008              STRB     r0,[r1,#0]            ;68
000096  e05f              B        |L3.344|
                  |L3.152|
000098  48dd              LDR      r0,|L3.1040|
00009a  7800              LDRB     r0,[r0,#0]            ;71  ; PollingMeterID
00009c  1e40              SUBS     r0,r0,#1              ;71
00009e  49df              LDR      r1,|L3.1052|
0000a0  5c08              LDRB     r0,[r1,r0]            ;71
0000a2  49df              LDR      r1,|L3.1056|
0000a4  7008              STRB     r0,[r1,#0]            ;71
0000a6  2100              MOVS     r1,#0                 ;72
0000a8  48d9              LDR      r0,|L3.1040|
0000aa  7800              LDRB     r0,[r0,#0]            ;72  ; PollingMeterID
0000ac  1e40              SUBS     r0,r0,#1              ;72
0000ae  4adb              LDR      r2,|L3.1052|
0000b0  5411              STRB     r1,[r2,r0]            ;72
0000b2  48d7              LDR      r0,|L3.1040|
0000b4  7800              LDRB     r0,[r0,#0]            ;73  ; PollingMeterID
0000b6  49d8              LDR      r1,|L3.1048|
0000b8  7008              STRB     r0,[r1,#0]            ;73
0000ba  48d9              LDR      r0,|L3.1056|
0000bc  7800              LDRB     r0,[r0,#0]            ;74  ; ModBusCommand
0000be  0003              MOVS     r3,r0                 ;74
0000c0  f7fffffe          BL       __ARM_common_switch8
0000c4  0c074848          DCB      0x0c,0x07,0x48,0x48
0000c8  08124848          DCB      0x08,0x12,0x48,0x48
0000cc  1c232a34          DCB      0x1c,0x23,0x2a,0x34
0000d0  3e48              DCB      0x3e,0x48
0000d2  e040              B        |L3.342|
0000d4  2001              MOVS     r0,#1                 ;79
0000d6  49d3              LDR      r1,|L3.1060|
0000d8  7008              STRB     r0,[r1,#0]            ;79
0000da  200e              MOVS     r0,#0xe               ;80
0000dc  49c8              LDR      r1,|L3.1024|
0000de  7008              STRB     r0,[r1,#0]            ;80
0000e0  2000              MOVS     r0,#0                 ;81
0000e2  49cf              LDR      r1,|L3.1056|
0000e4  7008              STRB     r0,[r1,#0]            ;81
0000e6  e036              B        |L3.342|
0000e8  2000              MOVS     r0,#0                 ;84
0000ea  49ce              LDR      r1,|L3.1060|
0000ec  7008              STRB     r0,[r1,#0]            ;84
0000ee  200e              MOVS     r0,#0xe               ;85
0000f0  49c3              LDR      r1,|L3.1024|
0000f2  7008              STRB     r0,[r1,#0]            ;85
0000f4  2000              MOVS     r0,#0                 ;86
0000f6  49ca              LDR      r1,|L3.1056|
0000f8  7008              STRB     r0,[r1,#0]            ;86
0000fa  e02c              B        |L3.342|
0000fc  2011              MOVS     r0,#0x11              ;89
0000fe  49c0              LDR      r1,|L3.1024|
000100  7008              STRB     r0,[r1,#0]            ;89
000102  2000              MOVS     r0,#0                 ;90
000104  49c6              LDR      r1,|L3.1056|
000106  7008              STRB     r0,[r1,#0]            ;90
000108  e025              B        |L3.342|
00010a  2014              MOVS     r0,#0x14              ;93
00010c  49bc              LDR      r1,|L3.1024|
00010e  7008              STRB     r0,[r1,#0]            ;93
000110  2000              MOVS     r0,#0                 ;94
000112  49c3              LDR      r1,|L3.1056|
000114  7008              STRB     r0,[r1,#0]            ;94
000116  e01e              B        |L3.342|
000118  2001              MOVS     r0,#1                 ;97
00011a  49c2              LDR      r1,|L3.1060|
00011c  7008              STRB     r0,[r1,#0]            ;97
00011e  2017              MOVS     r0,#0x17              ;98
000120  49b7              LDR      r1,|L3.1024|
000122  7008              STRB     r0,[r1,#0]            ;98
000124  2000              MOVS     r0,#0                 ;99
000126  49be              LDR      r1,|L3.1056|
000128  7008              STRB     r0,[r1,#0]            ;99
00012a  e014              B        |L3.342|
00012c  2000              MOVS     r0,#0                 ;102
00012e  49bd              LDR      r1,|L3.1060|
000130  7008              STRB     r0,[r1,#0]            ;102
000132  201d              MOVS     r0,#0x1d              ;103
000134  49b2              LDR      r1,|L3.1024|
000136  7008              STRB     r0,[r1,#0]            ;103
000138  2000              MOVS     r0,#0                 ;104
00013a  49b9              LDR      r1,|L3.1056|
00013c  7008              STRB     r0,[r1,#0]            ;104
00013e  e00a              B        |L3.342|
000140  2000              MOVS     r0,#0                 ;107
000142  49b8              LDR      r1,|L3.1060|
000144  7008              STRB     r0,[r1,#0]            ;107
000146  2023              MOVS     r0,#0x23              ;108
000148  49ad              LDR      r1,|L3.1024|
00014a  7008              STRB     r0,[r1,#0]            ;108
00014c  2000              MOVS     r0,#0                 ;109
00014e  49b4              LDR      r1,|L3.1056|
000150  7008              STRB     r0,[r1,#0]            ;109
000152  e000              B        |L3.342|
000154  bf00              NOP                            ;112
                  |L3.342|
000156  bf00              NOP                            ;77
                  |L3.344|
000158  e221              B        |L3.1438|
00015a  48b3              LDR      r0,|L3.1064|
00015c  7800              LDRB     r0,[r0,#0]            ;117  ; GotMeterRsp
00015e  49ae              LDR      r1,|L3.1048|
000160  7809              LDRB     r1,[r1,#0]            ;117  ; PowerMeterID
000162  4288              CMP      r0,r1                 ;117
000164  d102              BNE      |L3.364|
000166  f7fffffe          BL       MeterSuccess
00016a  e001              B        |L3.368|
                  |L3.364|
00016c  f7fffffe          BL       MeterTimeoutProcess
                  |L3.368|
000170  e215              B        |L3.1438|
000172  2001              MOVS     r0,#1                 ;125
000174  f7fffffe          BL       MODBUS_SendCmd
000178  2001              MOVS     r0,#1                 ;126
00017a  49a1              LDR      r1,|L3.1024|
00017c  7008              STRB     r0,[r1,#0]            ;126
00017e  2000              MOVS     r0,#0                 ;127
000180  49aa              LDR      r1,|L3.1068|
000182  7008              STRB     r0,[r1,#0]            ;127
000184  e20b              B        |L3.1438|
000186  2005              MOVS     r0,#5                 ;136
000188  f7fffffe          BL       MODBUS_SendCmd
00018c  2001              MOVS     r0,#1                 ;137
00018e  499c              LDR      r1,|L3.1024|
000190  7008              STRB     r0,[r1,#0]            ;137
000192  2000              MOVS     r0,#0                 ;138
000194  49a5              LDR      r1,|L3.1068|
000196  7008              STRB     r0,[r1,#0]            ;138
000198  e201              B        |L3.1438|
00019a  489d              LDR      r0,|L3.1040|
00019c  7800              LDRB     r0,[r0,#0]            ;141  ; PollingMeterID
00019e  1e40              SUBS     r0,r0,#1              ;141
0001a0  49a3              LDR      r1,|L3.1072|
0001a2  5c08              LDRB     r0,[r1,r0]            ;141
0001a4  2803              CMP      r0,#3                 ;141
0001a6  d129              BNE      |L3.508|
0001a8  200c              MOVS     r0,#0xc               ;143
0001aa  f7fffffe          BL       MODBUS_SendCmd
0001ae  2001              MOVS     r0,#1                 ;144
0001b0  4993              LDR      r1,|L3.1024|
0001b2  7008              STRB     r0,[r1,#0]            ;144
0001b4  2000              MOVS     r0,#0                 ;145
0001b6  499d              LDR      r1,|L3.1068|
0001b8  7008              STRB     r0,[r1,#0]            ;145
0001ba  e028              B        |L3.526|
0001bc  e1da              B        |L3.1396|
0001be  e1cb              B        |L3.1368|
0001c0  e1ba              B        |L3.1336|
0001c2  e1af              B        |L3.1316|
0001c4  e19d              B        |L3.1282|
0001c6  e18c              B        |L3.1250|
0001c8  e17b              B        |L3.1218|
0001ca  e16a              B        |L3.1186|
0001cc  e157              B        |L3.1150|
0001ce  e14a              B        |L3.1126|
0001d0  e136              B        |L3.1088|
0001d2  e100              B        |L3.982|
0001d4  e0ee              B        |L3.948|
0001d6  e0dc              B        |L3.914|
0001d8  e0c8              B        |L3.876|
0001da  e0bb              B        |L3.852|
0001dc  e0ac              B        |L3.824|
0001de  e0a1              B        |L3.804|
0001e0  e092              B        |L3.776|
0001e2  e087              B        |L3.756|
0001e4  e1d7              B        |L3.1430|
0001e6  e077              B        |L3.728|
0001e8  e06c              B        |L3.708|
0001ea  e061              B        |L3.688|
0001ec  e056              B        |L3.668|
0001ee  e04b              B        |L3.648|
0001f0  e040              B        |L3.628|
0001f2  e035              B        |L3.608|
0001f4  e02a              B        |L3.588|
0001f6  e01f              B        |L3.568|
0001f8  e014              B        |L3.548|
0001fa  e009              B        |L3.528|
                  |L3.508|
0001fc  2000              MOVS     r0,#0                 ;147
0001fe  4980              LDR      r1,|L3.1024|
000200  7008              STRB     r0,[r1,#0]            ;147
000202  4882              LDR      r0,|L3.1036|
000204  7800              LDRB     r0,[r0,#0]            ;148  ; PollingStateIndex
000206  1c40              ADDS     r0,r0,#1              ;148
000208  4980              LDR      r1,|L3.1036|
00020a  7008              STRB     r0,[r1,#0]            ;148
00020c  e1c7              B        |L3.1438|
                  |L3.526|
00020e  e1c6              B        |L3.1438|
                  |L3.528|
000210  200d              MOVS     r0,#0xd               ;153
000212  f7fffffe          BL       MODBUS_SendCmd
000216  2001              MOVS     r0,#1                 ;154
000218  4979              LDR      r1,|L3.1024|
00021a  7008              STRB     r0,[r1,#0]            ;154
00021c  2000              MOVS     r0,#0                 ;155
00021e  4983              LDR      r1,|L3.1068|
000220  7008              STRB     r0,[r1,#0]            ;155
000222  e1bc              B        |L3.1438|
                  |L3.548|
000224  200e              MOVS     r0,#0xe               ;158
000226  f7fffffe          BL       MODBUS_SendCmd
00022a  2001              MOVS     r0,#1                 ;159
00022c  4974              LDR      r1,|L3.1024|
00022e  7008              STRB     r0,[r1,#0]            ;159
000230  2000              MOVS     r0,#0                 ;160
000232  497e              LDR      r1,|L3.1068|
000234  7008              STRB     r0,[r1,#0]            ;160
000236  e1b2              B        |L3.1438|
                  |L3.568|
000238  200f              MOVS     r0,#0xf               ;163
00023a  f7fffffe          BL       MODBUS_SendCmd
00023e  2001              MOVS     r0,#1                 ;164
000240  496f              LDR      r1,|L3.1024|
000242  7008              STRB     r0,[r1,#0]            ;164
000244  2000              MOVS     r0,#0                 ;165
000246  4979              LDR      r1,|L3.1068|
000248  7008              STRB     r0,[r1,#0]            ;165
00024a  e1a8              B        |L3.1438|
                  |L3.588|
00024c  2010              MOVS     r0,#0x10              ;168
00024e  f7fffffe          BL       MODBUS_SendCmd
000252  2001              MOVS     r0,#1                 ;169
000254  496a              LDR      r1,|L3.1024|
000256  7008              STRB     r0,[r1,#0]            ;169
000258  2000              MOVS     r0,#0                 ;170
00025a  4974              LDR      r1,|L3.1068|
00025c  7008              STRB     r0,[r1,#0]            ;170
00025e  e19e              B        |L3.1438|
                  |L3.608|
000260  2011              MOVS     r0,#0x11              ;173
000262  f7fffffe          BL       MODBUS_SendCmd
000266  2001              MOVS     r0,#1                 ;174
000268  4965              LDR      r1,|L3.1024|
00026a  7008              STRB     r0,[r1,#0]            ;174
00026c  2000              MOVS     r0,#0                 ;175
00026e  496f              LDR      r1,|L3.1068|
000270  7008              STRB     r0,[r1,#0]            ;175
000272  e194              B        |L3.1438|
                  |L3.628|
000274  2012              MOVS     r0,#0x12              ;178
000276  f7fffffe          BL       MODBUS_SendCmd
00027a  2001              MOVS     r0,#1                 ;179
00027c  4960              LDR      r1,|L3.1024|
00027e  7008              STRB     r0,[r1,#0]            ;179
000280  2000              MOVS     r0,#0                 ;180
000282  496a              LDR      r1,|L3.1068|
000284  7008              STRB     r0,[r1,#0]            ;180
000286  e18a              B        |L3.1438|
                  |L3.648|
000288  2013              MOVS     r0,#0x13              ;184
00028a  f7fffffe          BL       MODBUS_SendCmd
00028e  2001              MOVS     r0,#1                 ;185
000290  495b              LDR      r1,|L3.1024|
000292  7008              STRB     r0,[r1,#0]            ;185
000294  2000              MOVS     r0,#0                 ;186
000296  4965              LDR      r1,|L3.1068|
000298  7008              STRB     r0,[r1,#0]            ;186
00029a  e180              B        |L3.1438|
                  |L3.668|
00029c  2014              MOVS     r0,#0x14              ;189
00029e  f7fffffe          BL       MODBUS_SendCmd
0002a2  2001              MOVS     r0,#1                 ;190
0002a4  4956              LDR      r1,|L3.1024|
0002a6  7008              STRB     r0,[r1,#0]            ;190
0002a8  2000              MOVS     r0,#0                 ;191
0002aa  4960              LDR      r1,|L3.1068|
0002ac  7008              STRB     r0,[r1,#0]            ;191
0002ae  e176              B        |L3.1438|
                  |L3.688|
0002b0  2015              MOVS     r0,#0x15              ;194
0002b2  f7fffffe          BL       MODBUS_SendCmd
0002b6  2001              MOVS     r0,#1                 ;195
0002b8  4951              LDR      r1,|L3.1024|
0002ba  7008              STRB     r0,[r1,#0]            ;195
0002bc  2000              MOVS     r0,#0                 ;196
0002be  495b              LDR      r1,|L3.1068|
0002c0  7008              STRB     r0,[r1,#0]            ;196
0002c2  e16c              B        |L3.1438|
                  |L3.708|
0002c4  2008              MOVS     r0,#8                 ;199
0002c6  f7fffffe          BL       MODBUS_SendCmd
0002ca  200f              MOVS     r0,#0xf               ;200
0002cc  494c              LDR      r1,|L3.1024|
0002ce  7008              STRB     r0,[r1,#0]            ;200
0002d0  2000              MOVS     r0,#0                 ;201
0002d2  4958              LDR      r1,|L3.1076|
0002d4  7008              STRB     r0,[r1,#0]            ;201
0002d6  e162              B        |L3.1438|
                  |L3.728|
0002d8  4856              LDR      r0,|L3.1076|
0002da  7800              LDRB     r0,[r0,#0]            ;204  ; DelayTime4NextCmd
0002dc  2828              CMP      r0,#0x28              ;204
0002de  dd08              BLE      |L3.754|
0002e0  2000              MOVS     r0,#0                 ;206
0002e2  4954              LDR      r1,|L3.1076|
0002e4  7008              STRB     r0,[r1,#0]            ;206
0002e6  2002              MOVS     r0,#2                 ;208
0002e8  f7fffffe          BL       MODBUS_SendCmd
0002ec  2000              MOVS     r0,#0                 ;209
0002ee  4944              LDR      r1,|L3.1024|
0002f0  7008              STRB     r0,[r1,#0]            ;209
                  |L3.754|
0002f2  e154              B        |L3.1438|
                  |L3.756|
0002f4  2008              MOVS     r0,#8                 ;213
0002f6  f7fffffe          BL       MODBUS_SendCmd
0002fa  2012              MOVS     r0,#0x12              ;214
0002fc  4940              LDR      r1,|L3.1024|
0002fe  7008              STRB     r0,[r1,#0]            ;214
000300  2000              MOVS     r0,#0                 ;215
000302  494c              LDR      r1,|L3.1076|
000304  7008              STRB     r0,[r1,#0]            ;215
000306  e14a              B        |L3.1438|
                  |L3.776|
000308  484a              LDR      r0,|L3.1076|
00030a  7800              LDRB     r0,[r0,#0]            ;218  ; DelayTime4NextCmd
00030c  281e              CMP      r0,#0x1e              ;218
00030e  dd08              BLE      |L3.802|
000310  2000              MOVS     r0,#0                 ;220
000312  4948              LDR      r1,|L3.1076|
000314  7008              STRB     r0,[r1,#0]            ;220
000316  200b              MOVS     r0,#0xb               ;222
000318  f7fffffe          BL       MODBUS_SendCmd
00031c  2000              MOVS     r0,#0                 ;223
00031e  4938              LDR      r1,|L3.1024|
000320  7008              STRB     r0,[r1,#0]            ;223
                  |L3.802|
000322  e13c              B        |L3.1438|
                  |L3.804|
000324  2008              MOVS     r0,#8                 ;227
000326  f7fffffe          BL       MODBUS_SendCmd
00032a  2015              MOVS     r0,#0x15              ;228
00032c  4934              LDR      r1,|L3.1024|
00032e  7008              STRB     r0,[r1,#0]            ;228
000330  2000              MOVS     r0,#0                 ;229
000332  4940              LDR      r1,|L3.1076|
000334  7008              STRB     r0,[r1,#0]            ;229
000336  e132              B        |L3.1438|
                  |L3.824|
000338  483e              LDR      r0,|L3.1076|
00033a  7800              LDRB     r0,[r0,#0]            ;232  ; DelayTime4NextCmd
00033c  281e              CMP      r0,#0x1e              ;232
00033e  dd08              BLE      |L3.850|
000340  2000              MOVS     r0,#0                 ;234
000342  493c              LDR      r1,|L3.1076|
000344  7008              STRB     r0,[r1,#0]            ;234
000346  200a              MOVS     r0,#0xa               ;236
000348  f7fffffe          BL       MODBUS_SendCmd
00034c  2000              MOVS     r0,#0                 ;237
00034e  492c              LDR      r1,|L3.1024|
000350  7008              STRB     r0,[r1,#0]            ;237
                  |L3.850|
000352  e124              B        |L3.1438|
                  |L3.852|
000354  2000              MOVS     r0,#0                 ;241
000356  4937              LDR      r1,|L3.1076|
000358  7008              STRB     r0,[r1,#0]            ;241
00035a  4937              LDR      r1,|L3.1080|
00035c  8008              STRH     r0,[r1,#0]            ;242
00035e  2008              MOVS     r0,#8                 ;243
000360  f7fffffe          BL       MODBUS_SendCmd
000364  2018              MOVS     r0,#0x18              ;244
000366  4926              LDR      r1,|L3.1024|
000368  7008              STRB     r0,[r1,#0]            ;244
00036a  e118              B        |L3.1438|
                  |L3.876|
00036c  4831              LDR      r0,|L3.1076|
00036e  7800              LDRB     r0,[r0,#0]            ;247  ; DelayTime4NextCmd
000370  2832              CMP      r0,#0x32              ;247
000372  dd0d              BLE      |L3.912|
000374  2000              MOVS     r0,#0                 ;250
000376  492f              LDR      r1,|L3.1076|
000378  7008              STRB     r0,[r1,#0]            ;250
00037a  4930              LDR      r1,|L3.1084|
00037c  7008              STRB     r0,[r1,#0]            ;251
00037e  2019              MOVS     r0,#0x19              ;252
000380  491f              LDR      r1,|L3.1024|
000382  7008              STRB     r0,[r1,#0]            ;252
000384  2000              MOVS     r0,#0                 ;253
000386  492c              LDR      r1,|L3.1080|
000388  8008              STRH     r0,[r1,#0]            ;253
00038a  2017              MOVS     r0,#0x17              ;254
00038c  f7fffffe          BL       MODBUS_SendCmd
                  |L3.912|
000390  e105              B        |L3.1438|
                  |L3.914|
000392  4828              LDR      r0,|L3.1076|
000394  7800              LDRB     r0,[r0,#0]            ;258  ; DelayTime4NextCmd
000396  2832              CMP      r0,#0x32              ;258
000398  dd0b              BLE      |L3.946|
00039a  2000              MOVS     r0,#0                 ;261
00039c  4925              LDR      r1,|L3.1076|
00039e  7008              STRB     r0,[r1,#0]            ;261
0003a0  201a              MOVS     r0,#0x1a              ;262
0003a2  4917              LDR      r1,|L3.1024|
0003a4  7008              STRB     r0,[r1,#0]            ;262
0003a6  2000              MOVS     r0,#0                 ;263
0003a8  4923              LDR      r1,|L3.1080|
0003aa  8008              STRH     r0,[r1,#0]            ;263
0003ac  2008              MOVS     r0,#8                 ;264
0003ae  f7fffffe          BL       MODBUS_SendCmd
                  |L3.946|
0003b2  e0f4              B        |L3.1438|
                  |L3.948|
0003b4  481f              LDR      r0,|L3.1076|
0003b6  7800              LDRB     r0,[r0,#0]            ;268  ; DelayTime4NextCmd
0003b8  2832              CMP      r0,#0x32              ;268
0003ba  dd0b              BLE      |L3.980|
0003bc  2000              MOVS     r0,#0                 ;271
0003be  491d              LDR      r1,|L3.1076|
0003c0  7008              STRB     r0,[r1,#0]            ;271
0003c2  201b              MOVS     r0,#0x1b              ;272
0003c4  490e              LDR      r1,|L3.1024|
0003c6  7008              STRB     r0,[r1,#0]            ;272
0003c8  2000              MOVS     r0,#0                 ;273
0003ca  491b              LDR      r1,|L3.1080|
0003cc  8008              STRH     r0,[r1,#0]            ;273
0003ce  200b              MOVS     r0,#0xb               ;274
0003d0  f7fffffe          BL       MODBUS_SendCmd
                  |L3.980|
0003d4  e0e3              B        |L3.1438|
                  |L3.982|
0003d6  4817              LDR      r0,|L3.1076|
0003d8  7800              LDRB     r0,[r0,#0]            ;278  ; DelayTime4NextCmd
0003da  2832              CMP      r0,#0x32              ;278
0003dc  dd0b              BLE      |L3.1014|
0003de  2000              MOVS     r0,#0                 ;281
0003e0  4914              LDR      r1,|L3.1076|
0003e2  7008              STRB     r0,[r1,#0]            ;281
0003e4  201c              MOVS     r0,#0x1c              ;282
0003e6  4906              LDR      r1,|L3.1024|
0003e8  7008              STRB     r0,[r1,#0]            ;282
0003ea  2000              MOVS     r0,#0                 ;283
0003ec  4912              LDR      r1,|L3.1080|
0003ee  8008              STRH     r0,[r1,#0]            ;283
0003f0  2008              MOVS     r0,#8                 ;284
0003f2  f7fffffe          BL       MODBUS_SendCmd
                  |L3.1014|
0003f6  e0d2              B        |L3.1438|
                  |L3.1016|
                          DCD      MeterActive
                  |L3.1020|
                          DCD      MyMeterID
                  |L3.1024|
                          DCD      MeterPollingState
                  |L3.1028|
                          DCD      TickReadPowerTime
                  |L3.1032|
                          DCD      ReadMeterTime
                  |L3.1036|
                          DCD      PollingStateIndex
                  |L3.1040|
                          DCD      PollingMeterID
                  |L3.1044|
                          DCD      MaxPowerMeter
                  |L3.1048|
                          DCD      PowerMeterID
                  |L3.1052|
                          DCD      ModBusCommandList
                  |L3.1056|
                          DCD      ModBusCommand
                  |L3.1060|
                          DCD      RelayOnOff
                  |L3.1064|
                          DCD      GotMeterRsp
                  |L3.1068|
                          DCD      TickPollingMeterInterval
                  |L3.1072|
                          DCD      RoomMode
                  |L3.1076|
                          DCD      DelayTime4NextCmd
                  |L3.1080|
                          DCD      Tick5mS_CheckRoomMode
                  |L3.1084|
                          DCD      PayMode
                  |L3.1088|
000440  4858              LDR      r0,|L3.1444|
000442  7800              LDRB     r0,[r0,#0]            ;288  ; DelayTime4NextCmd
000444  2832              CMP      r0,#0x32              ;288
000446  dd0d              BLE      |L3.1124|
000448  2000              MOVS     r0,#0                 ;291
00044a  4956              LDR      r1,|L3.1444|
00044c  7008              STRB     r0,[r1,#0]            ;291
00044e  2001              MOVS     r0,#1                 ;292
000450  4955              LDR      r1,|L3.1448|
000452  7008              STRB     r0,[r1,#0]            ;292
000454  2000              MOVS     r0,#0                 ;293
000456  4955              LDR      r1,|L3.1452|
000458  7008              STRB     r0,[r1,#0]            ;293
00045a  4955              LDR      r1,|L3.1456|
00045c  8008              STRH     r0,[r1,#0]            ;294
00045e  2002              MOVS     r0,#2                 ;295
000460  f7fffffe          BL       MODBUS_SendCmd
                  |L3.1124|
000464  e09b              B        |L3.1438|
                  |L3.1126|
000466  201e              MOVS     r0,#0x1e              ;299
000468  4950              LDR      r1,|L3.1452|
00046a  7008              STRB     r0,[r1,#0]            ;299
00046c  2000              MOVS     r0,#0                 ;300
00046e  494d              LDR      r1,|L3.1444|
000470  7008              STRB     r0,[r1,#0]            ;300
000472  494f              LDR      r1,|L3.1456|
000474  8008              STRH     r0,[r1,#0]            ;301
000476  2008              MOVS     r0,#8                 ;302
000478  f7fffffe          BL       MODBUS_SendCmd
00047c  e08f              B        |L3.1438|
                  |L3.1150|
00047e  4849              LDR      r0,|L3.1444|
000480  7800              LDRB     r0,[r0,#0]            ;305  ; DelayTime4NextCmd
000482  2832              CMP      r0,#0x32              ;305
000484  dd0c              BLE      |L3.1184|
000486  2000              MOVS     r0,#0                 ;307
000488  4946              LDR      r1,|L3.1444|
00048a  7008              STRB     r0,[r1,#0]            ;307
00048c  4949              LDR      r1,|L3.1460|
00048e  7008              STRB     r0,[r1,#0]            ;309
000490  4947              LDR      r1,|L3.1456|
000492  8008              STRH     r0,[r1,#0]            ;310
000494  2017              MOVS     r0,#0x17              ;311
000496  f7fffffe          BL       MODBUS_SendCmd
00049a  2021              MOVS     r0,#0x21              ;312
00049c  4943              LDR      r1,|L3.1452|
00049e  7008              STRB     r0,[r1,#0]            ;312
                  |L3.1184|
0004a0  e07d              B        |L3.1438|
                  |L3.1186|
0004a2  4840              LDR      r0,|L3.1444|
0004a4  7800              LDRB     r0,[r0,#0]            ;316  ; DelayTime4NextCmd
0004a6  2832              CMP      r0,#0x32              ;316
0004a8  dd0a              BLE      |L3.1216|
0004aa  2000              MOVS     r0,#0                 ;318
0004ac  493d              LDR      r1,|L3.1444|
0004ae  7008              STRB     r0,[r1,#0]            ;318
0004b0  493f              LDR      r1,|L3.1456|
0004b2  8008              STRH     r0,[r1,#0]            ;320
0004b4  2008              MOVS     r0,#8                 ;321
0004b6  f7fffffe          BL       MODBUS_SendCmd
0004ba  2020              MOVS     r0,#0x20              ;322
0004bc  493b              LDR      r1,|L3.1452|
0004be  7008              STRB     r0,[r1,#0]            ;322
                  |L3.1216|
0004c0  e06d              B        |L3.1438|
                  |L3.1218|
0004c2  4838              LDR      r0,|L3.1444|
0004c4  7800              LDRB     r0,[r0,#0]            ;326  ; DelayTime4NextCmd
0004c6  2832              CMP      r0,#0x32              ;326
0004c8  dd0a              BLE      |L3.1248|
0004ca  2021              MOVS     r0,#0x21              ;328
0004cc  4937              LDR      r1,|L3.1452|
0004ce  7008              STRB     r0,[r1,#0]            ;328
0004d0  2000              MOVS     r0,#0                 ;329
0004d2  4934              LDR      r1,|L3.1444|
0004d4  7008              STRB     r0,[r1,#0]            ;329
0004d6  4936              LDR      r1,|L3.1456|
0004d8  8008              STRH     r0,[r1,#0]            ;330
0004da  200b              MOVS     r0,#0xb               ;331
0004dc  f7fffffe          BL       MODBUS_SendCmd
                  |L3.1248|
0004e0  e05d              B        |L3.1438|
                  |L3.1250|
0004e2  4830              LDR      r0,|L3.1444|
0004e4  7800              LDRB     r0,[r0,#0]            ;335  ; DelayTime4NextCmd
0004e6  2832              CMP      r0,#0x32              ;335
0004e8  dd0a              BLE      |L3.1280|
0004ea  2000              MOVS     r0,#0                 ;337
0004ec  492d              LDR      r1,|L3.1444|
0004ee  7008              STRB     r0,[r1,#0]            ;337
0004f0  492f              LDR      r1,|L3.1456|
0004f2  8008              STRH     r0,[r1,#0]            ;339
0004f4  2008              MOVS     r0,#8                 ;340
0004f6  f7fffffe          BL       MODBUS_SendCmd
0004fa  2022              MOVS     r0,#0x22              ;341
0004fc  492b              LDR      r1,|L3.1452|
0004fe  7008              STRB     r0,[r1,#0]            ;341
                  |L3.1280|
000500  e04d              B        |L3.1438|
                  |L3.1282|
000502  4828              LDR      r0,|L3.1444|
000504  7800              LDRB     r0,[r0,#0]            ;345  ; DelayTime4NextCmd
000506  2832              CMP      r0,#0x32              ;345
000508  dd0b              BLE      |L3.1314|
00050a  2000              MOVS     r0,#0                 ;347
00050c  4927              LDR      r1,|L3.1452|
00050e  7008              STRB     r0,[r1,#0]            ;347
000510  4924              LDR      r1,|L3.1444|
000512  7008              STRB     r0,[r1,#0]            ;348
000514  4924              LDR      r1,|L3.1448|
000516  7008              STRB     r0,[r1,#0]            ;349
000518  4925              LDR      r1,|L3.1456|
00051a  8008              STRH     r0,[r1,#0]            ;350
00051c  2002              MOVS     r0,#2                 ;351
00051e  f7fffffe          BL       MODBUS_SendCmd
                  |L3.1314|
000522  e03c              B        |L3.1438|
                  |L3.1316|
000524  2008              MOVS     r0,#8                 ;355
000526  f7fffffe          BL       MODBUS_SendCmd
00052a  2024              MOVS     r0,#0x24              ;356
00052c  491f              LDR      r1,|L3.1452|
00052e  7008              STRB     r0,[r1,#0]            ;356
000530  2000              MOVS     r0,#0                 ;357
000532  491c              LDR      r1,|L3.1444|
000534  7008              STRB     r0,[r1,#0]            ;357
000536  e032              B        |L3.1438|
                  |L3.1336|
000538  481a              LDR      r0,|L3.1444|
00053a  7800              LDRB     r0,[r0,#0]            ;360  ; DelayTime4NextCmd
00053c  2832              CMP      r0,#0x32              ;360
00053e  dd0a              BLE      |L3.1366|
000540  2000              MOVS     r0,#0                 ;362
000542  4918              LDR      r1,|L3.1444|
000544  7008              STRB     r0,[r1,#0]            ;362
000546  4918              LDR      r1,|L3.1448|
000548  7008              STRB     r0,[r1,#0]            ;364
00054a  2002              MOVS     r0,#2                 ;365
00054c  f7fffffe          BL       MODBUS_SendCmd
000550  2025              MOVS     r0,#0x25              ;366
000552  4916              LDR      r1,|L3.1452|
000554  7008              STRB     r0,[r1,#0]            ;366
                  |L3.1366|
000556  e022              B        |L3.1438|
                  |L3.1368|
000558  4812              LDR      r0,|L3.1444|
00055a  7800              LDRB     r0,[r0,#0]            ;370  ; DelayTime4NextCmd
00055c  2832              CMP      r0,#0x32              ;370
00055e  dd08              BLE      |L3.1394|
000560  2000              MOVS     r0,#0                 ;372
000562  4910              LDR      r1,|L3.1444|
000564  7008              STRB     r0,[r1,#0]            ;372
000566  2008              MOVS     r0,#8                 ;374
000568  f7fffffe          BL       MODBUS_SendCmd
00056c  2026              MOVS     r0,#0x26              ;375
00056e  490f              LDR      r1,|L3.1452|
000570  7008              STRB     r0,[r1,#0]            ;375
                  |L3.1394|
000572  e014              B        |L3.1438|
                  |L3.1396|
000574  480b              LDR      r0,|L3.1444|
000576  7800              LDRB     r0,[r0,#0]            ;379  ; DelayTime4NextCmd
000578  2832              CMP      r0,#0x32              ;379
00057a  dd0b              BLE      |L3.1428|
00057c  2000              MOVS     r0,#0                 ;381
00057e  4909              LDR      r1,|L3.1444|
000580  7008              STRB     r0,[r1,#0]            ;381
000582  2001              MOVS     r0,#1                 ;383
000584  490b              LDR      r1,|L3.1460|
000586  7008              STRB     r0,[r1,#0]            ;383
000588  2017              MOVS     r0,#0x17              ;384
00058a  f7fffffe          BL       MODBUS_SendCmd
00058e  2000              MOVS     r0,#0                 ;385
000590  4906              LDR      r1,|L3.1452|
000592  7008              STRB     r0,[r1,#0]            ;385
                  |L3.1428|
000594  e003              B        |L3.1438|
                  |L3.1430|
000596  2000              MOVS     r0,#0                 ;390
000598  4904              LDR      r1,|L3.1452|
00059a  7008              STRB     r0,[r1,#0]            ;390
00059c  bf00              NOP                            ;391
                  |L3.1438|
00059e  bf00              NOP                            ;115
0005a0  bf00              NOP      
0005a2  e534              B        |L3.14|
;;;395    
                          ENDP

                  |L3.1444|
                          DCD      DelayTime4NextCmd
                  |L3.1448|
                          DCD      RelayOnOff
                  |L3.1452|
                          DCD      MeterPollingState
                  |L3.1456|
                          DCD      Tick5mS_CheckRoomMode
                  |L3.1460|
                          DCD      PayMode

                          AREA ||i.MeterProcess||, CODE, READONLY, ALIGN=2

                  MeterProcess PROC
;;;396    
;;;397    void MeterProcess(void)
000000  b510              PUSH     {r4,lr}
;;;398    {
;;;399        //uint32_t GapMeterPower;
;;;400    
;;;401        if( TokenMeterReady )
000002  4831              LDR      r0,|L4.200|
000004  7800              LDRB     r0,[r0,#0]  ; TokenMeterReady
000006  2800              CMP      r0,#0
000008  d05d              BEQ      |L4.198|
;;;402        {
;;;403            TokenMeterReady = 0 ;        
00000a  2000              MOVS     r0,#0
00000c  492e              LDR      r1,|L4.200|
00000e  7008              STRB     r0,[r1,#0]
;;;404            CRC16(TokenMeter, METER_RXQLen-2);
000010  482e              LDR      r0,|L4.204|
000012  7800              LDRB     r0,[r0,#0]  ; METER_RXQLen
000014  1e80              SUBS     r0,r0,#2
000016  b281              UXTH     r1,r0
000018  482d              LDR      r0,|L4.208|
00001a  f7fffffe          BL       CRC16
;;;405            if ( (TokenMeter[METER_RXQLen-2]==uchCRCHi) && (TokenMeter[METER_RXQLen-1]==uchCRCLo) )
00001e  482b              LDR      r0,|L4.204|
000020  7800              LDRB     r0,[r0,#0]  ; METER_RXQLen
000022  1e80              SUBS     r0,r0,#2
000024  492a              LDR      r1,|L4.208|
000026  5c08              LDRB     r0,[r1,r0]
000028  492a              LDR      r1,|L4.212|
00002a  7809              LDRB     r1,[r1,#0]  ; uchCRCHi
00002c  4288              CMP      r0,r1
00002e  d144              BNE      |L4.186|
000030  4826              LDR      r0,|L4.204|
000032  7800              LDRB     r0,[r0,#0]  ; METER_RXQLen
000034  1e40              SUBS     r0,r0,#1
000036  4926              LDR      r1,|L4.208|
000038  5c08              LDRB     r0,[r1,r0]
00003a  4927              LDR      r1,|L4.216|
00003c  7809              LDRB     r1,[r1,#0]  ; uchCRCLo
00003e  4288              CMP      r0,r1
000040  d13b              BNE      |L4.186|
;;;406            {
;;;407                GotMeterRsp = TokenMeter[0] ;
000042  4823              LDR      r0,|L4.208|
000044  7800              LDRB     r0,[r0,#0]  ; TokenMeter
000046  4925              LDR      r1,|L4.220|
000048  7008              STRB     r0,[r1,#0]
;;;408                if ( MeterActive == MyMeterID ) 
00004a  4825              LDR      r0,|L4.224|
00004c  7800              LDRB     r0,[r0,#0]  ; MeterActive
00004e  4925              LDR      r1,|L4.228|
000050  7809              LDRB     r1,[r1,#0]  ; MyMeterID
000052  4288              CMP      r0,r1
000054  d124              BNE      |L4.160|
;;;409                {
;;;410                    MeterErrorRate5Min_Rx[GotMeterRsp-1][MeterErrorRate5Min_Wp]++; 
000056  4821              LDR      r0,|L4.220|
000058  7800              LDRB     r0,[r0,#0]  ; GotMeterRsp
00005a  1e40              SUBS     r0,r0,#1
00005c  2118              MOVS     r1,#0x18
00005e  4348              MULS     r0,r1,r0
000060  4921              LDR      r1,|L4.232|
000062  1840              ADDS     r0,r0,r1
000064  4921              LDR      r1,|L4.236|
000066  7809              LDRB     r1,[r1,#0]  ; MeterErrorRate5Min_Wp
000068  0049              LSLS     r1,r1,#1
00006a  5a40              LDRH     r0,[r0,r1]
00006c  1c40              ADDS     r0,r0,#1
00006e  b281              UXTH     r1,r0
000070  481a              LDR      r0,|L4.220|
000072  7800              LDRB     r0,[r0,#0]  ; GotMeterRsp
000074  1e40              SUBS     r0,r0,#1
000076  2218              MOVS     r2,#0x18
000078  4350              MULS     r0,r2,r0
00007a  4a1b              LDR      r2,|L4.232|
00007c  1880              ADDS     r0,r0,r2
00007e  4a1b              LDR      r2,|L4.236|
000080  7812              LDRB     r2,[r2,#0]  ; MeterErrorRate5Min_Wp
000082  0052              LSLS     r2,r2,#1
000084  5281              STRH     r1,[r0,r2]
;;;411                    PowerMeterRxCounter[GotMeterRsp-1]++;
000086  4815              LDR      r0,|L4.220|
000088  7800              LDRB     r0,[r0,#0]  ; GotMeterRsp
00008a  1e40              SUBS     r0,r0,#1
00008c  0080              LSLS     r0,r0,#2
00008e  4918              LDR      r1,|L4.240|
000090  5808              LDR      r0,[r1,r0]
000092  1c40              ADDS     r0,r0,#1
000094  4911              LDR      r1,|L4.220|
000096  7809              LDRB     r1,[r1,#0]  ; GotMeterRsp
000098  1e49              SUBS     r1,r1,#1
00009a  0089              LSLS     r1,r1,#2
00009c  4a14              LDR      r2,|L4.240|
00009e  5050              STR      r0,[r2,r1]
                  |L4.160|
;;;412                }
;;;413                PowerMeterError &= (~(0x00000001 << (GotMeterRsp-1)));
0000a0  480e              LDR      r0,|L4.220|
0000a2  7800              LDRB     r0,[r0,#0]  ; GotMeterRsp
0000a4  1e40              SUBS     r0,r0,#1
0000a6  2101              MOVS     r1,#1
0000a8  4081              LSLS     r1,r1,r0
0000aa  4812              LDR      r0,|L4.244|
0000ac  6800              LDR      r0,[r0,#0]  ; PowerMeterError
0000ae  4388              BICS     r0,r0,r1
0000b0  4910              LDR      r1,|L4.244|
0000b2  6008              STR      r0,[r1,#0]  ; PowerMeterError
;;;414                MeterDataProcess();					
0000b4  f7fffffe          BL       MeterDataProcess
0000b8  e005              B        |L4.198|
                  |L4.186|
;;;415            } else {
;;;416                GotMeterRsp = TokenMeter[0] ;
0000ba  4805              LDR      r0,|L4.208|
0000bc  7800              LDRB     r0,[r0,#0]  ; TokenMeter
0000be  4907              LDR      r1,|L4.220|
0000c0  7008              STRB     r0,[r1,#0]
;;;417                ResetMeterUART();	
0000c2  f7fffffe          BL       ResetMeterUART
                  |L4.198|
;;;418            }
;;;419        }
;;;420    	
;;;421    }
0000c6  bd10              POP      {r4,pc}
;;;422    
                          ENDP

                  |L4.200|
                          DCD      TokenMeterReady
                  |L4.204|
                          DCD      METER_RXQLen
                  |L4.208|
                          DCD      TokenMeter
                  |L4.212|
                          DCD      uchCRCHi
                  |L4.216|
                          DCD      uchCRCLo
                  |L4.220|
                          DCD      GotMeterRsp
                  |L4.224|
                          DCD      MeterActive
                  |L4.228|
                          DCD      MyMeterID
                  |L4.232|
                          DCD      MeterErrorRate5Min_Rx
                  |L4.236|
                          DCD      MeterErrorRate5Min_Wp
                  |L4.240|
                          DCD      PowerMeterRxCounter
                  |L4.244|
                          DCD      PowerMeterError

                          AREA ||i.MeterSuccess||, CODE, READONLY, ALIGN=2

                  MeterSuccess PROC
;;;717    #define METER_POLL_TIMEOUT 	50
;;;718    void MeterSuccess(void)
000000  4809              LDR      r0,|L5.40|
;;;719    {	
;;;720        PowerMeterError &= (~(0x00000001 <<  (PollingMeterID-1) ) );
000002  7800              LDRB     r0,[r0,#0]  ; PollingMeterID
000004  1e40              SUBS     r0,r0,#1
000006  2101              MOVS     r1,#1
000008  4081              LSLS     r1,r1,r0
00000a  4808              LDR      r0,|L5.44|
00000c  6800              LDR      r0,[r0,#0]  ; PowerMeterError
00000e  4388              BICS     r0,r0,r1
000010  4906              LDR      r1,|L5.44|
000012  6008              STR      r0,[r1,#0]  ; PowerMeterError
;;;721        PollingStateIndex++;
000014  4806              LDR      r0,|L5.48|
000016  7800              LDRB     r0,[r0,#0]  ; PollingStateIndex
000018  1c40              ADDS     r0,r0,#1
00001a  4905              LDR      r1,|L5.48|
00001c  7008              STRB     r0,[r1,#0]
;;;722        MeterPollingState = MP_READY;	
00001e  2000              MOVS     r0,#0
000020  4904              LDR      r1,|L5.52|
000022  7008              STRB     r0,[r1,#0]
;;;723    }
000024  4770              BX       lr
;;;724    void MeterTimeoutProcess(void)
                          ENDP

000026  0000              DCW      0x0000
                  |L5.40|
                          DCD      PollingMeterID
                  |L5.44|
                          DCD      PowerMeterError
                  |L5.48|
                          DCD      PollingStateIndex
                  |L5.52|
                          DCD      MeterPollingState

                          AREA ||i.MeterTimeoutProcess||, CODE, READONLY, ALIGN=2

                  MeterTimeoutProcess PROC
;;;723    }
;;;724    void MeterTimeoutProcess(void)
000000  b510              PUSH     {r4,lr}
;;;725    {
;;;726        // 25 x 20mSec Timeout 
;;;727        if ( TickPollingMeterInterval > METER_POLL_TIMEOUT )
000002  4812              LDR      r0,|L6.76|
000004  7800              LDRB     r0,[r0,#0]  ; TickPollingMeterInterval
000006  2832              CMP      r0,#0x32
000008  dd1f              BLE      |L6.74|
;;;728        {
;;;729            MeterPollingState = MP_READY;							
00000a  2000              MOVS     r0,#0
00000c  4910              LDR      r1,|L6.80|
00000e  7008              STRB     r0,[r1,#0]
;;;730            PowerMeterReadErrorCnt++;
000010  4810              LDR      r0,|L6.84|
000012  7800              LDRB     r0,[r0,#0]  ; PowerMeterReadErrorCnt
000014  1c40              ADDS     r0,r0,#1
000016  490f              LDR      r1,|L6.84|
000018  7008              STRB     r0,[r1,#0]
;;;731            if( PowerMeterReadErrorCnt > METER_ERROR_TIMES )
00001a  4608              MOV      r0,r1
00001c  7800              LDRB     r0,[r0,#0]  ; PowerMeterReadErrorCnt
00001e  2805              CMP      r0,#5
000020  dd13              BLE      |L6.74|
;;;732            {
;;;733                PowerMeterError |=  (0x00000001 <<  (PollingMeterID-1) ) ;
000022  480d              LDR      r0,|L6.88|
000024  7801              LDRB     r1,[r0,#0]  ; PollingMeterID
000026  1e49              SUBS     r1,r1,#1
000028  2001              MOVS     r0,#1
00002a  4088              LSLS     r0,r0,r1
00002c  490b              LDR      r1,|L6.92|
00002e  6809              LDR      r1,[r1,#0]  ; PowerMeterError
000030  4308              ORRS     r0,r0,r1
000032  490a              LDR      r1,|L6.92|
000034  6008              STR      r0,[r1,#0]  ; PowerMeterError
;;;734                PollingStateIndex++;
000036  480a              LDR      r0,|L6.96|
000038  7800              LDRB     r0,[r0,#0]  ; PollingStateIndex
00003a  1c40              ADDS     r0,r0,#1
00003c  4908              LDR      r1,|L6.96|
00003e  7008              STRB     r0,[r1,#0]
;;;735                PowerMeterReadErrorCnt = 0 ;            
000040  2000              MOVS     r0,#0
000042  4904              LDR      r1,|L6.84|
000044  7008              STRB     r0,[r1,#0]
;;;736                ResetMeterUART();
000046  f7fffffe          BL       ResetMeterUART
                  |L6.74|
;;;737            }
;;;738        }
;;;739    }
00004a  bd10              POP      {r4,pc}
;;;740    
                          ENDP

                  |L6.76|
                          DCD      TickPollingMeterInterval
                  |L6.80|
                          DCD      MeterPollingState
                  |L6.84|
                          DCD      PowerMeterReadErrorCnt
                  |L6.88|
                          DCD      PollingMeterID
                  |L6.92|
                          DCD      PowerMeterError
                  |L6.96|
                          DCD      PollingStateIndex

                          AREA ||i._SendStringToMETER||, CODE, READONLY, ALIGN=2

                  _SendStringToMETER PROC
;;;740    
;;;741    uint8_t _SendStringToMETER(uint8_t *Str, uint8_t len)
000000  b5f8              PUSH     {r3-r7,lr}
;;;742    {
000002  4607              MOV      r7,r0
000004  460d              MOV      r5,r1
;;;743    	
;;;744    	uint8_t idx;
;;;745        uint8_t u8MeterID;
;;;746    
;;;747    	if( (METERTxQ_cnt+len) > MAX_METER_TXQ_LENGTH )
000006  481d              LDR      r0,|L7.124|
000008  7800              LDRB     r0,[r0,#0]  ; METERTxQ_cnt
00000a  1940              ADDS     r0,r0,r5
00000c  2819              CMP      r0,#0x19
00000e  dd01              BLE      |L7.20|
;;;748    	{
;;;749    		return 0x01 ;
000010  2001              MOVS     r0,#1
                  |L7.18|
;;;750    	} else {
;;;751    	        u8MeterID = MeterTxBuffer[0]-1;
;;;752    	        PowerMeterTxCounter[u8MeterID]++;
;;;753    		//DIR_METER_RS485_Out();
;;;754    		for(idx=0;idx<len;idx++)
;;;755    		{
;;;756    			METERTxQ[METERTxQ_wp]=Str[idx];
;;;757    			METERTxQ_wp++;
;;;758    			if(METERTxQ_wp>=MAX_METER_TXQ_LENGTH)
;;;759    			{
;;;760    				METERTxQ_wp=0;
;;;761    			}
;;;762    			METERTxQ_cnt++;
;;;763    		}        			
;;;764    		UART_EnableInt(UART2, (UART_INTEN_THREIEN_Msk ));
;;;765    		NVIC_EnableIRQ(UART02_IRQn);
;;;766    	}                   
;;;767    	return 0x00 ;
;;;768    }
000012  bdf8              POP      {r3-r7,pc}
                  |L7.20|
000014  481a              LDR      r0,|L7.128|
000016  7800              LDRB     r0,[r0,#0]            ;751  ; MeterTxBuffer
000018  1e40              SUBS     r0,r0,#1              ;751
00001a  b2c6              UXTB     r6,r0                 ;751
00001c  00b0              LSLS     r0,r6,#2              ;752
00001e  4919              LDR      r1,|L7.132|
000020  5808              LDR      r0,[r1,r0]            ;752
000022  1c40              ADDS     r0,r0,#1              ;752
000024  00b1              LSLS     r1,r6,#2              ;752
000026  4a17              LDR      r2,|L7.132|
000028  5050              STR      r0,[r2,r1]            ;752
00002a  2400              MOVS     r4,#0                 ;754
00002c  e016              B        |L7.92|
                  |L7.46|
00002e  5d38              LDRB     r0,[r7,r4]            ;756
000030  4915              LDR      r1,|L7.136|
000032  4a16              LDR      r2,|L7.140|
000034  7812              LDRB     r2,[r2,#0]            ;756  ; METERTxQ_wp
000036  5488              STRB     r0,[r1,r2]            ;756
000038  4814              LDR      r0,|L7.140|
00003a  7800              LDRB     r0,[r0,#0]            ;757  ; METERTxQ_wp
00003c  1c40              ADDS     r0,r0,#1              ;757
00003e  4913              LDR      r1,|L7.140|
000040  7008              STRB     r0,[r1,#0]            ;757
000042  4608              MOV      r0,r1                 ;758
000044  7800              LDRB     r0,[r0,#0]            ;758  ; METERTxQ_wp
000046  2819              CMP      r0,#0x19              ;758
000048  db01              BLT      |L7.78|
00004a  2000              MOVS     r0,#0                 ;760
00004c  7008              STRB     r0,[r1,#0]            ;760
                  |L7.78|
00004e  480b              LDR      r0,|L7.124|
000050  7800              LDRB     r0,[r0,#0]            ;762  ; METERTxQ_cnt
000052  1c40              ADDS     r0,r0,#1              ;762
000054  4909              LDR      r1,|L7.124|
000056  7008              STRB     r0,[r1,#0]            ;762
000058  1c60              ADDS     r0,r4,#1              ;754
00005a  b2c4              UXTB     r4,r0                 ;754
                  |L7.92|
00005c  42ac              CMP      r4,r5                 ;754
00005e  dbe6              BLT      |L7.46|
000060  2102              MOVS     r1,#2                 ;764
000062  480b              LDR      r0,|L7.144|
000064  f7fffffe          BL       UART_EnableInt
000068  200c              MOVS     r0,#0xc               ;765
00006a  2101              MOVS     r1,#1                 ;765
00006c  4081              LSLS     r1,r1,r0              ;765
00006e  4a09              LDR      r2,|L7.148|
000070  6011              STR      r1,[r2,#0]            ;765
000072  bf00              NOP                            ;765
000074  bf00              NOP                            ;765
000076  2000              MOVS     r0,#0                 ;767
000078  e7cb              B        |L7.18|
;;;769    
                          ENDP

00007a  0000              DCW      0x0000
                  |L7.124|
                          DCD      METERTxQ_cnt
                  |L7.128|
                          DCD      MeterTxBuffer
                  |L7.132|
                          DCD      PowerMeterTxCounter
                  |L7.136|
                          DCD      METERTxQ
                  |L7.140|
                          DCD      METERTxQ_wp
                  |L7.144|
                          DCD      0x40154000
                  |L7.148|
                          DCD      0xe000e100

                          AREA ||.bss||, DATA, NOINIT, ALIGN=1

                  GapErrorTimes
                          %        32
                  MeterErrorRate5Min_Tx
                          %        744
                  MeterErrorRate5Min_Rx
                          %        744

                          AREA ||.data||, DATA, ALIGN=2

                  TickMeter
000000  00                DCB      0x00
                  MeterRelayStatus
000001  00                DCB      0x00
                  MeterRelayStausReady
000002  00                DCB      0x00
                  fgMeterAddValue
000003  00                DCB      0x00
                  PowerMeterReadErrorCnt
000004  00                DCB      0x00
                  PollingStateIndex
000005  00                DCB      0x00
                  PollingMeterID
000006  0000              DCB      0x00,0x00
                  Tick1S_ErrorRateGap
000008  00000000          DCB      0x00,0x00,0x00,0x00
                  PowerMeterError
                          DCD      0x00000000
                  MeterErrorRate5Min_Wp
000010  00                DCB      0x00
                  u8MeterInitState
000011  00                DCB      0x00
                  Tick10mSec_PowerMeterInit
000012  0000              DCB      0x00,0x00

                          AREA ||i.__ARM_common_switch8||, COMGROUP=__ARM_common_switch8, CODE, READONLY, ALIGN=1

                  __ARM_common_switch8 PROC
000000  b430              PUSH     {r4,r5}
000002  4674              MOV      r4,lr
000004  1e64              SUBS     r4,r4,#1
000006  7825              LDRB     r5,[r4,#0]
000008  1c64              ADDS     r4,r4,#1
00000a  42ab              CMP      r3,r5
00000c  d304              BCC      |L53.24|
                  |L53.14|
00000e  5d63              LDRB     r3,[r4,r5]
000010  005b              LSLS     r3,r3,#1
000012  18e3              ADDS     r3,r4,r3
000014  bc30              POP      {r4,r5}
000016  4718              BX       r3
                  |L53.24|
000018  461d              MOV      r5,r3
00001a  e7f8              B        |L53.14|
                          ENDP


;*** Start embedded assembler ***

#line 1 "..\\AO_MeterProcess.c"
	AREA ||.rev16_text||, CODE
	THUMB
	EXPORT |__asm___17_AO_MeterProcess_c_6b52f95d____REV16|
#line 388 "..\\..\\..\\NUC126_Series_BSP_CMSIS_V3.00.005\\Library\\CMSIS\\Include\\cmsis_armcc.h"
|__asm___17_AO_MeterProcess_c_6b52f95d____REV16| PROC
#line 389

 rev16 r0, r0
 bx lr
	ENDP
	AREA ||.revsh_text||, CODE
	THUMB
	EXPORT |__asm___17_AO_MeterProcess_c_6b52f95d____REVSH|
#line 402
|__asm___17_AO_MeterProcess_c_6b52f95d____REVSH| PROC
#line 403

 revsh r0, r0
 bx lr
	ENDP

;*** End   embedded assembler ***
